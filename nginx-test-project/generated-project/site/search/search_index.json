{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"nginx-test-service \u00b6 \uac1c\uc694 \u00b6 NGINX \ud14c\uc2a4\ud2b8 \uc6f9\uc11c\ube44\uc2a4 - Backstage \ud15c\ud50c\ub9bf\uc73c\ub85c \uc0dd\uc131\ub41c \uc815\uc801 \uc0ac\uc774\ud2b8 \uc774 \ud504\ub85c\uc81d\ud2b8\ub294 NGINX \uae30\ubc18 \uc6f9 \uc11c\ube44\uc2a4\ub85c, \ub2e4\uc74c\uacfc \uac19\uc740 \ud2b9\uc9d5\uc744 \uac00\uc9c0\uace0 \uc788\uc2b5\ub2c8\ub2e4: \uc11c\ube44\uc2a4 \ud0c0\uc785 : static-site NGINX \ubc84\uc804 : 1.25 \ub808\ud50c\ub9ac\uce74 \uc218 : 3\uac1c \ub3c4\uba54\uc778 : localhost \uc544\ud0a4\ud14d\ucc98 \u00b6 1 2 3 4 5 graph TB A[Client] --> B[Load Balancer] B --> C[NGINX Pod 1] B --> D[NGINX Pod 2] B --> E[NGINX Pod 3] \uc8fc\uc694 \uae30\ub2a5 \u00b6 \uc6f9 \uc11c\ube44\uc2a4 \uae30\ub2a5 \u00b6 \uc815\uc801 \uc0ac\uc774\ud2b8 \ud638\uc2a4\ud305 : HTML, CSS, JavaScript \ud30c\uc77c \uc11c\ube59 \uce90\uc2f1 : \uc815\uc801 \uc790\uc0b0\uc5d0 \ub300\ud55c \ud6a8\uc728\uc801\uc778 \uce90\uc2f1 \uc131\ub2a5 \ucd5c\uc801\ud654 \u00b6 Gzip \uc555\ucd95 : \uc751\ub2f5 \ub370\uc774\ud130 \uc555\ucd95\uc73c\ub85c \ub300\uc5ed\ud3ed \uc808\uc57d \ubcf4\uc548 \uae30\ub2a5 \u00b6 \ucee4\uc2a4\ud140 \uc5d0\ub7ec \ud398\uc774\uc9c0 : \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801\uc778 \uc624\ub958 \ud398\uc774\uc9c0 \ubaa8\ub2c8\ud130\ub9c1 \ubc0f \ub85c\uae45 \u00b6 \uc811\uadfc \ub85c\uadf8 : combined \ud615\uc2dd\uc758 \uc0c1\uc138 \ub85c\uadf8 \ubc30\ud3ec \uc815\ubcf4 \u00b6 \ubc30\ud3ec \ud0c0\uc785 : docker-compose \ud3ec\ud2b8 : 8082 (HTTP) \uba54\ud2b8\ub9ad \ud3ec\ud2b8 : 9114 (Prometheus) \ube60\ub978 \uc2dc\uc791 \u00b6 \uc11c\ube44\uc2a4\ub97c \uc2dc\uc791\ud558\ub824\uba74 Getting Started \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694. \ubb38\uc11c \uad6c\uc870 \u00b6 Getting Started - \uac1c\ubc1c \ud658\uacbd \uc124\uc815 \ubc0f \uccab \ubc30\ud3ec Configuration - \uc0c1\uc138 \uc124\uc815 \uc635\uc158 Deployment - \ubc30\ud3ec \uac00\uc774\ub4dc (Docker Compose, Kubernetes) Monitoring - \ubaa8\ub2c8\ud130\ub9c1 \ubc0f \uc54c\ub9bc \uc124\uc815 Security - \ubcf4\uc548 \uc124\uc815 \ubc0f \ubaa8\ubc94 \uc0ac\ub840 Troubleshooting - \ubb38\uc81c \ud574\uacb0 \uac00\uc774\ub4dc \uc9c0\uc6d0 \ubc0f \ubb38\uc758 \u00b6 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uac70\ub098 \uc9c8\ubb38\uc774 \uc788\uc73c\uc2dc\uba74 \ub2e4\uc74c\uc744 \ucc38\uc870\ud558\uc138\uc694: Troubleshooting \uac00\uc774\ub4dc GitHub Issues Platform Team \uc5f0\ub77d\ucc98","title":"Home"},{"location":"#nginx-test-service","text":"","title":"nginx-test-service"},{"location":"#_1","text":"NGINX \ud14c\uc2a4\ud2b8 \uc6f9\uc11c\ube44\uc2a4 - Backstage \ud15c\ud50c\ub9bf\uc73c\ub85c \uc0dd\uc131\ub41c \uc815\uc801 \uc0ac\uc774\ud2b8 \uc774 \ud504\ub85c\uc81d\ud2b8\ub294 NGINX \uae30\ubc18 \uc6f9 \uc11c\ube44\uc2a4\ub85c, \ub2e4\uc74c\uacfc \uac19\uc740 \ud2b9\uc9d5\uc744 \uac00\uc9c0\uace0 \uc788\uc2b5\ub2c8\ub2e4: \uc11c\ube44\uc2a4 \ud0c0\uc785 : static-site NGINX \ubc84\uc804 : 1.25 \ub808\ud50c\ub9ac\uce74 \uc218 : 3\uac1c \ub3c4\uba54\uc778 : localhost","title":"\uac1c\uc694"},{"location":"#_2","text":"1 2 3 4 5 graph TB A[Client] --> B[Load Balancer] B --> C[NGINX Pod 1] B --> D[NGINX Pod 2] B --> E[NGINX Pod 3]","title":"\uc544\ud0a4\ud14d\ucc98"},{"location":"#_3","text":"","title":"\uc8fc\uc694 \uae30\ub2a5"},{"location":"#_4","text":"\uc815\uc801 \uc0ac\uc774\ud2b8 \ud638\uc2a4\ud305 : HTML, CSS, JavaScript \ud30c\uc77c \uc11c\ube59 \uce90\uc2f1 : \uc815\uc801 \uc790\uc0b0\uc5d0 \ub300\ud55c \ud6a8\uc728\uc801\uc778 \uce90\uc2f1","title":"\uc6f9 \uc11c\ube44\uc2a4 \uae30\ub2a5"},{"location":"#_5","text":"Gzip \uc555\ucd95 : \uc751\ub2f5 \ub370\uc774\ud130 \uc555\ucd95\uc73c\ub85c \ub300\uc5ed\ud3ed \uc808\uc57d","title":"\uc131\ub2a5 \ucd5c\uc801\ud654"},{"location":"#_6","text":"\ucee4\uc2a4\ud140 \uc5d0\ub7ec \ud398\uc774\uc9c0 : \uc0ac\uc6a9\uc790 \uce5c\ud654\uc801\uc778 \uc624\ub958 \ud398\uc774\uc9c0","title":"\ubcf4\uc548 \uae30\ub2a5"},{"location":"#_7","text":"\uc811\uadfc \ub85c\uadf8 : combined \ud615\uc2dd\uc758 \uc0c1\uc138 \ub85c\uadf8","title":"\ubaa8\ub2c8\ud130\ub9c1 \ubc0f \ub85c\uae45"},{"location":"#_8","text":"\ubc30\ud3ec \ud0c0\uc785 : docker-compose \ud3ec\ud2b8 : 8082 (HTTP) \uba54\ud2b8\ub9ad \ud3ec\ud2b8 : 9114 (Prometheus)","title":"\ubc30\ud3ec \uc815\ubcf4"},{"location":"#_9","text":"\uc11c\ube44\uc2a4\ub97c \uc2dc\uc791\ud558\ub824\uba74 Getting Started \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.","title":"\ube60\ub978 \uc2dc\uc791"},{"location":"#_10","text":"Getting Started - \uac1c\ubc1c \ud658\uacbd \uc124\uc815 \ubc0f \uccab \ubc30\ud3ec Configuration - \uc0c1\uc138 \uc124\uc815 \uc635\uc158 Deployment - \ubc30\ud3ec \uac00\uc774\ub4dc (Docker Compose, Kubernetes) Monitoring - \ubaa8\ub2c8\ud130\ub9c1 \ubc0f \uc54c\ub9bc \uc124\uc815 Security - \ubcf4\uc548 \uc124\uc815 \ubc0f \ubaa8\ubc94 \uc0ac\ub840 Troubleshooting - \ubb38\uc81c \ud574\uacb0 \uac00\uc774\ub4dc","title":"\ubb38\uc11c \uad6c\uc870"},{"location":"#_11","text":"\ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uac70\ub098 \uc9c8\ubb38\uc774 \uc788\uc73c\uc2dc\uba74 \ub2e4\uc74c\uc744 \ucc38\uc870\ud558\uc138\uc694: Troubleshooting \uac00\uc774\ub4dc GitHub Issues Platform Team \uc5f0\ub77d\ucc98","title":"\uc9c0\uc6d0 \ubc0f \ubb38\uc758"},{"location":"configuration/","text":"Configuration \u00b6 \uc774 \ubb38\uc11c\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\uc758 \uc0c1\uc138 \uc124\uc815 \uc635\uc158\uc744 \uc124\uba85\ud569\ub2c8\ub2e4. NGINX \uc124\uc815 \u00b6 \uba54\uc778 \uc124\uc815 (nginx.conf) \u00b6 config/nginx.conf \ud30c\uc77c\uc740 NGINX\uc758 \uc804\uc5ed \uc124\uc815\uc744 \ub2f4\uace0 \uc788\uc2b5\ub2c8\ub2e4: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 user nginx ; worker_processes auto ; error_log /var/log/nginx/error.log warn ; pid /var/run/nginx.pid ; events { worker_connections 1024 ; use epoll ; multi_accept on ; } http { include /etc/nginx/mime.types ; default_type application/octet-stream ; # \ub85c\uadf8 \ud615\uc2dd {% if values.logFormat == \"json\" % } log_format json_combined escape=json ' { ' '\"time_local\":\" $time_local\",' '\"remote_addr\":\" $remote_addr\",' '\"remote_user\":\" $remote_user\",' '\"request\":\" $request\",' '\"status\": \" $status\",' '\"body_bytes_sent\":\" $body_bytes_sent\",' '\"request_time\":\" $request_time\",' '\"http_referrer\":\" $http_referer\",' '\"http_user_agent\":\" $http_user_agent\"' ' } ' ; {% endif % } # \uc131\ub2a5 \ucd5c\uc801\ud654 sendfile on ; tcp_nopush on ; tcp_nodelay on ; keepalive_timeout 65 ; types_hash_max_size 2048 ; {% if values.enableGzip % } # Gzip \uc555\ucd95 gzip on ; gzip_vary on ; gzip_min_length 1024 ; gzip_proxied any ; gzip_comp_level 6 ; gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/atom+xml image/svg+xml ; {% endif % } { % if values.enableBrotli % } # Brotli \uc555\ucd95 brotli on ; brotli_comp_level 6 ; brotli_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript ; {% endif % } include /etc/nginx/conf.d/*.conf ; } \uc0ac\uc774\ud2b8 \uc124\uc815 (default.conf) \u00b6 config/default.conf \ud30c\uc77c\uc740 \uc6f9\uc0ac\uc774\ud2b8\ubcc4 \uc124\uc815\uc744 \ub2f4\uace0 \uc788\uc2b5\ub2c8\ub2e4: {% if values.serviceType == \"static-site\" %} \uc815\uc801 \uc0ac\uc774\ud2b8 \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 server { listen 80 ; {% if values.domain % } server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; {% endif % } root /usr/share/nginx/html ; index index.html index.htm ; {% if values.enableCaching % } # \uc815\uc801 \uc790\uc0b0 \uce90\uc2f1 location ~ * \\.(css|js|png|jpg|jpeg|gif|ico|svg) $ { expires 1y ; add_header Cache-Control \"public, immutable\" ; } {% endif % } { % if values.enableRateLimit % } # \uc18d\ub3c4 \uc81c\ud55c limit_req_zone $binary_remote_addr zone=api:10m rate= ${{ values.rateLimitRpm }} r/m ; limit_req zone=api burst=20 nodelay ; {% endif % } location / { try_files $uri $uri/ = 404 ; } } \ub9ac\ubc84\uc2a4 \ud504\ub85d\uc2dc \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 upstream backend { server backend1 : 8080 ; server backend2 : 8080 ; server backend3 : 8080 ; } server { listen 80 ; {% if values.domain % } server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; {% endif % } { % if values.enableRateLimit % } # \uc18d\ub3c4 \uc81c\ud55c limit_req_zone $binary_remote_addr zone=api:10m rate= ${{ values.rateLimitRpm }} r/m ; limit_req zone=api burst=20 nodelay ; {% endif % } location / { proxy_pass http://backend ; proxy_set_header Host $host ; proxy_set_header X-Real-IP $remote_addr ; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ; proxy_set_header X-Forwarded-Proto $scheme ; # \ud0c0\uc784\uc544\uc6c3 \uc124\uc815 proxy_connect_timeout 30s ; proxy_send_timeout 30s ; proxy_read_timeout 30s ; } } SPA \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 server { listen 80 ; {% if values.domain % } server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; {% endif % } root /usr/share/nginx/html ; index index.html ; {% if values.enableCaching % } # \uc815\uc801 \uc790\uc0b0 \uce90\uc2f1 location ~ * \\.(css|js|png|jpg|jpeg|gif|ico|svg) $ { expires 1y ; add_header Cache-Control \"public, immutable\" ; } {% endif % } # SPA \ub77c\uc6b0\ud305 \uc9c0\uc6d0 location / { try_files $uri $uri/ /index.html ; } # API \ud504\ub85d\uc2dc (\ud544\uc694\uc2dc) location /api/ { proxy_pass http://api-backend/ ; proxy_set_header Host $host ; proxy_set_header X-Real-IP $remote_addr ; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ; } } \ud658\uacbd \ubcc0\uc218 \u00b6 Docker Compose \ud658\uacbd \ubcc0\uc218 \u00b6 .env \ud30c\uc77c\uc5d0\uc11c \uc124\uc815\ud560 \uc218 \uc788\ub294 \uc8fc\uc694 \ud658\uacbd \ubcc0\uc218: \ubcc0\uc218\uba85 \uae30\ubcf8\uac12 \uc124\uba85 SERVICE_NAME ${{ values.name }} \uc11c\ube44\uc2a4 \uc774\ub984 SERVICE_PORT ${{ values.port }} \uc11c\ube44\uc2a4 \ud3ec\ud2b8 NGINX_VERSION ${{ values.nginxVersion }} NGINX Docker \uc774\ubbf8\uc9c0 \ubc84\uc804 {% if values.domain %} DOMAIN ${{ values.domain }} \uc8fc \ub3c4\uba54\uc778 {% endif %} {% if values.enableSSL %} SSL_ENABLED true SSL/TLS \ud65c\uc131\ud654 \uc5ec\ubd80 SSL_PROVIDER ${{ values.sslProvider }} SSL \uc778\uc99d\uc11c \uc81c\uacf5\uc790 {% endif %} {% if values.enableMonitoring %} MONITORING_ENABLED true \ubaa8\ub2c8\ud130\ub9c1 \ud65c\uc131\ud654 \uc5ec\ubd80 {% endif %} Kubernetes \ud658\uacbd \ubcc0\uc218 \u00b6 Kubernetes \ubc30\ud3ec \uc2dc ConfigMap\uacfc Secret\uc744 \ud1b5\ud574 \uc124\uc815: 1 2 3 4 5 6 7 8 9 10 11 12 13 apiVersion : v1 kind : ConfigMap metadata : name : ${{ values.name }}-config data : NGINX_VERSION : \"${{ values.nginxVersion }}\" SERVICE_PORT : \"${{ values.port }}\" { % if values.enableCaching % } CACHE_SIZE : \"${{ values.cacheSize }}\" { % endif % } { % if values.enableRateLimit % } RATE_LIMIT_RPM : \"${{ values.rateLimitRpm }}\" { % endif % } \ubcf4\uc548 \uc124\uc815 \u00b6 {% if values.enableBasicAuth %} HTTP Basic Authentication \u00b6 \uae30\ubcf8 \uc778\uc99d\uc744 \ud65c\uc131\ud654\ud558\ub824\uba74 .htpasswd \ud30c\uc77c\uc744 \uc0dd\uc131\ud558\uc138\uc694: 1 2 3 4 5 6 # \uc0ac\uc6a9\uc790 \ucd94\uac00 htpasswd -c .htpasswd username # NGINX \uc124\uc815\uc5d0 \ucd94\uac00 auth_basic \"Restricted Area\" ; auth_basic_user_file /etc/nginx/.htpasswd ; {% if values.allowedIPs %} IP \uc811\uadfc \uc81c\ud55c \u00b6 \ud2b9\uc815 IP\ub9cc \uc811\uadfc\uc744 \ud5c8\uc6a9\ud558\ub824\uba74: 1 2 3 4 5 6 7 8 location / { {% for ip in values.allowedIPs % } allow { { ip }} ; {% endfor % } deny all ; # \ub098\uba38\uc9c0 \uc124\uc815... } \ubcf4\uc548 \ud5e4\ub354 \u00b6 \ubcf4\uc548\uc744 \uac15\ud654\ud558\uae30 \uc704\ud55c HTTP \ud5e4\ub354: 1 2 3 4 5 6 # \ubcf4\uc548 \ud5e4\ub354 \ucd94\uac00 add_header X-Frame-Options \"SAMEORIGIN\" always ; add_header X-XSS-Protection \"1 ; mode=block\" always ; add_header X-Content-Type-Options \"nosniff\" always ; add_header Referrer-Policy \"no-referrer-when-downgrade\" always ; add_header Content-Security-Policy \"default-src 'self' http: https: data: blob: 'unsafe-inline'\" always ; \uc131\ub2a5 \ud29c\ub2dd \u00b6 Worker \ud504\ub85c\uc138\uc2a4 \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 # CPU \ucf54\uc5b4 \uc218\uc5d0 \ub9de\ucdb0 \uc790\ub3d9 \uc124\uc815 worker_processes auto ; # \uc5f0\uacb0 \uc218 \ucd5c\uc801\ud654 events { worker_connections 1024 ; use epoll ; multi_accept on ; } \ubc84\ud37c \ud06c\uae30 \uc870\uc815 \u00b6 1 2 3 4 5 6 7 8 http { client_body_buffer_size 128k ; client_max_body_size 10m ; client_header_buffer_size 1k ; large_client_header_buffers 4 4k ; output_buffers 1 32k ; postpone_output 1460 ; } {% if values.enableCaching %} \uce90\uc2dc \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 # \ud504\ub85d\uc2dc \uce90\uc2dc \uc124\uc815 proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache: ${{ values.cacheSize }} max_size=1g inactive=60m use_temp_path=off ; location / { proxy_cache my_cache ; proxy_cache_revalidate on ; proxy_cache_min_uses 3 ; proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504 ; proxy_cache_background_update on ; proxy_cache_lock on ; } \ub85c\uae45 \uc124\uc815 \u00b6 \uc811\uadfc \ub85c\uadf8 \ud615\uc2dd \u00b6 {% if values.logFormat == \"json\" %} JSON \ud615\uc2dd \ub85c\uadf8: 1 2 3 4 5 6 7 8 9 10 11 12 13 log_format json_combined escape=json ' { ' '\"time_local\":\" $time_local\",' '\"remote_addr\":\" $remote_addr\",' '\"request\":\" $request\",' '\"status\": \" $status\",' '\"body_bytes_sent\":\" $body_bytes_sent\",' '\"request_time\":\" $request_time\",' '\"http_referrer\":\" $http_referer\",' '\"http_user_agent\":\" $http_user_agent\"' ' } ' ; access_log /var/log/nginx/access.log json_combined ; {% else %} \ud45c\uc900 \ud615\uc2dd \ub85c\uadf8: 1 2 3 4 5 log_format combined ' $remote_addr - $remote_user [ $time_local] ' '\" $request\" $status $body_bytes_sent ' '\" $http_referer\" \" $http_user_agent\"' ; access_log /var/log/nginx/access.log combined ; \ub85c\uadf8 \ub85c\ud14c\uc774\uc158 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # logrotate \uc124\uc815 (/etc/logrotate.d/nginx) /var/log/nginx/*.log { daily missingok rotate 52 compress delaycompress notifempty create 644 nginx nginx postrotate if [ -f /var/run/nginx.pid ] ; then kill -USR1 ` cat /var/run/nginx.pid ` fi endscript } \ubb38\uc81c \ud574\uacb0 \u00b6 \uc124\uc815 \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 Troubleshooting \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.","title":"Configuration"},{"location":"configuration/#configuration","text":"\uc774 \ubb38\uc11c\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\uc758 \uc0c1\uc138 \uc124\uc815 \uc635\uc158\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.","title":"Configuration"},{"location":"configuration/#nginx","text":"","title":"NGINX \uc124\uc815"},{"location":"configuration/#nginxconf","text":"config/nginx.conf \ud30c\uc77c\uc740 NGINX\uc758 \uc804\uc5ed \uc124\uc815\uc744 \ub2f4\uace0 \uc788\uc2b5\ub2c8\ub2e4: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 user nginx ; worker_processes auto ; error_log /var/log/nginx/error.log warn ; pid /var/run/nginx.pid ; events { worker_connections 1024 ; use epoll ; multi_accept on ; } http { include /etc/nginx/mime.types ; default_type application/octet-stream ; # \ub85c\uadf8 \ud615\uc2dd {% if values.logFormat == \"json\" % } log_format json_combined escape=json ' { ' '\"time_local\":\" $time_local\",' '\"remote_addr\":\" $remote_addr\",' '\"remote_user\":\" $remote_user\",' '\"request\":\" $request\",' '\"status\": \" $status\",' '\"body_bytes_sent\":\" $body_bytes_sent\",' '\"request_time\":\" $request_time\",' '\"http_referrer\":\" $http_referer\",' '\"http_user_agent\":\" $http_user_agent\"' ' } ' ; {% endif % } # \uc131\ub2a5 \ucd5c\uc801\ud654 sendfile on ; tcp_nopush on ; tcp_nodelay on ; keepalive_timeout 65 ; types_hash_max_size 2048 ; {% if values.enableGzip % } # Gzip \uc555\ucd95 gzip on ; gzip_vary on ; gzip_min_length 1024 ; gzip_proxied any ; gzip_comp_level 6 ; gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/atom+xml image/svg+xml ; {% endif % } { % if values.enableBrotli % } # Brotli \uc555\ucd95 brotli on ; brotli_comp_level 6 ; brotli_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript ; {% endif % } include /etc/nginx/conf.d/*.conf ; }","title":"\uba54\uc778 \uc124\uc815 (nginx.conf)"},{"location":"configuration/#defaultconf","text":"config/default.conf \ud30c\uc77c\uc740 \uc6f9\uc0ac\uc774\ud2b8\ubcc4 \uc124\uc815\uc744 \ub2f4\uace0 \uc788\uc2b5\ub2c8\ub2e4: {% if values.serviceType == \"static-site\" %}","title":"\uc0ac\uc774\ud2b8 \uc124\uc815 (default.conf)"},{"location":"configuration/#_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 server { listen 80 ; {% if values.domain % } server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; {% endif % } root /usr/share/nginx/html ; index index.html index.htm ; {% if values.enableCaching % } # \uc815\uc801 \uc790\uc0b0 \uce90\uc2f1 location ~ * \\.(css|js|png|jpg|jpeg|gif|ico|svg) $ { expires 1y ; add_header Cache-Control \"public, immutable\" ; } {% endif % } { % if values.enableRateLimit % } # \uc18d\ub3c4 \uc81c\ud55c limit_req_zone $binary_remote_addr zone=api:10m rate= ${{ values.rateLimitRpm }} r/m ; limit_req zone=api burst=20 nodelay ; {% endif % } location / { try_files $uri $uri/ = 404 ; } }","title":"\uc815\uc801 \uc0ac\uc774\ud2b8 \uc124\uc815"},{"location":"configuration/#_2","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 upstream backend { server backend1 : 8080 ; server backend2 : 8080 ; server backend3 : 8080 ; } server { listen 80 ; {% if values.domain % } server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; {% endif % } { % if values.enableRateLimit % } # \uc18d\ub3c4 \uc81c\ud55c limit_req_zone $binary_remote_addr zone=api:10m rate= ${{ values.rateLimitRpm }} r/m ; limit_req zone=api burst=20 nodelay ; {% endif % } location / { proxy_pass http://backend ; proxy_set_header Host $host ; proxy_set_header X-Real-IP $remote_addr ; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ; proxy_set_header X-Forwarded-Proto $scheme ; # \ud0c0\uc784\uc544\uc6c3 \uc124\uc815 proxy_connect_timeout 30s ; proxy_send_timeout 30s ; proxy_read_timeout 30s ; } }","title":"\ub9ac\ubc84\uc2a4 \ud504\ub85d\uc2dc \uc124\uc815"},{"location":"configuration/#spa","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 server { listen 80 ; {% if values.domain % } server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; {% endif % } root /usr/share/nginx/html ; index index.html ; {% if values.enableCaching % } # \uc815\uc801 \uc790\uc0b0 \uce90\uc2f1 location ~ * \\.(css|js|png|jpg|jpeg|gif|ico|svg) $ { expires 1y ; add_header Cache-Control \"public, immutable\" ; } {% endif % } # SPA \ub77c\uc6b0\ud305 \uc9c0\uc6d0 location / { try_files $uri $uri/ /index.html ; } # API \ud504\ub85d\uc2dc (\ud544\uc694\uc2dc) location /api/ { proxy_pass http://api-backend/ ; proxy_set_header Host $host ; proxy_set_header X-Real-IP $remote_addr ; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ; } }","title":"SPA \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc124\uc815"},{"location":"configuration/#_3","text":"","title":"\ud658\uacbd \ubcc0\uc218"},{"location":"configuration/#docker-compose","text":".env \ud30c\uc77c\uc5d0\uc11c \uc124\uc815\ud560 \uc218 \uc788\ub294 \uc8fc\uc694 \ud658\uacbd \ubcc0\uc218: \ubcc0\uc218\uba85 \uae30\ubcf8\uac12 \uc124\uba85 SERVICE_NAME ${{ values.name }} \uc11c\ube44\uc2a4 \uc774\ub984 SERVICE_PORT ${{ values.port }} \uc11c\ube44\uc2a4 \ud3ec\ud2b8 NGINX_VERSION ${{ values.nginxVersion }} NGINX Docker \uc774\ubbf8\uc9c0 \ubc84\uc804 {% if values.domain %} DOMAIN ${{ values.domain }} \uc8fc \ub3c4\uba54\uc778 {% endif %} {% if values.enableSSL %} SSL_ENABLED true SSL/TLS \ud65c\uc131\ud654 \uc5ec\ubd80 SSL_PROVIDER ${{ values.sslProvider }} SSL \uc778\uc99d\uc11c \uc81c\uacf5\uc790 {% endif %} {% if values.enableMonitoring %} MONITORING_ENABLED true \ubaa8\ub2c8\ud130\ub9c1 \ud65c\uc131\ud654 \uc5ec\ubd80 {% endif %}","title":"Docker Compose \ud658\uacbd \ubcc0\uc218"},{"location":"configuration/#kubernetes","text":"Kubernetes \ubc30\ud3ec \uc2dc ConfigMap\uacfc Secret\uc744 \ud1b5\ud574 \uc124\uc815: 1 2 3 4 5 6 7 8 9 10 11 12 13 apiVersion : v1 kind : ConfigMap metadata : name : ${{ values.name }}-config data : NGINX_VERSION : \"${{ values.nginxVersion }}\" SERVICE_PORT : \"${{ values.port }}\" { % if values.enableCaching % } CACHE_SIZE : \"${{ values.cacheSize }}\" { % endif % } { % if values.enableRateLimit % } RATE_LIMIT_RPM : \"${{ values.rateLimitRpm }}\" { % endif % }","title":"Kubernetes \ud658\uacbd \ubcc0\uc218"},{"location":"configuration/#_4","text":"{% if values.enableBasicAuth %}","title":"\ubcf4\uc548 \uc124\uc815"},{"location":"configuration/#http-basic-authentication","text":"\uae30\ubcf8 \uc778\uc99d\uc744 \ud65c\uc131\ud654\ud558\ub824\uba74 .htpasswd \ud30c\uc77c\uc744 \uc0dd\uc131\ud558\uc138\uc694: 1 2 3 4 5 6 # \uc0ac\uc6a9\uc790 \ucd94\uac00 htpasswd -c .htpasswd username # NGINX \uc124\uc815\uc5d0 \ucd94\uac00 auth_basic \"Restricted Area\" ; auth_basic_user_file /etc/nginx/.htpasswd ; {% if values.allowedIPs %}","title":"HTTP Basic Authentication"},{"location":"configuration/#ip","text":"\ud2b9\uc815 IP\ub9cc \uc811\uadfc\uc744 \ud5c8\uc6a9\ud558\ub824\uba74: 1 2 3 4 5 6 7 8 location / { {% for ip in values.allowedIPs % } allow { { ip }} ; {% endfor % } deny all ; # \ub098\uba38\uc9c0 \uc124\uc815... }","title":"IP \uc811\uadfc \uc81c\ud55c"},{"location":"configuration/#_5","text":"\ubcf4\uc548\uc744 \uac15\ud654\ud558\uae30 \uc704\ud55c HTTP \ud5e4\ub354: 1 2 3 4 5 6 # \ubcf4\uc548 \ud5e4\ub354 \ucd94\uac00 add_header X-Frame-Options \"SAMEORIGIN\" always ; add_header X-XSS-Protection \"1 ; mode=block\" always ; add_header X-Content-Type-Options \"nosniff\" always ; add_header Referrer-Policy \"no-referrer-when-downgrade\" always ; add_header Content-Security-Policy \"default-src 'self' http: https: data: blob: 'unsafe-inline'\" always ;","title":"\ubcf4\uc548 \ud5e4\ub354"},{"location":"configuration/#_6","text":"","title":"\uc131\ub2a5 \ud29c\ub2dd"},{"location":"configuration/#worker","text":"1 2 3 4 5 6 7 8 9 # CPU \ucf54\uc5b4 \uc218\uc5d0 \ub9de\ucdb0 \uc790\ub3d9 \uc124\uc815 worker_processes auto ; # \uc5f0\uacb0 \uc218 \ucd5c\uc801\ud654 events { worker_connections 1024 ; use epoll ; multi_accept on ; }","title":"Worker \ud504\ub85c\uc138\uc2a4 \uc124\uc815"},{"location":"configuration/#_7","text":"1 2 3 4 5 6 7 8 http { client_body_buffer_size 128k ; client_max_body_size 10m ; client_header_buffer_size 1k ; large_client_header_buffers 4 4k ; output_buffers 1 32k ; postpone_output 1460 ; } {% if values.enableCaching %}","title":"\ubc84\ud37c \ud06c\uae30 \uc870\uc815"},{"location":"configuration/#_8","text":"1 2 3 4 5 6 7 8 9 10 11 12 # \ud504\ub85d\uc2dc \uce90\uc2dc \uc124\uc815 proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache: ${{ values.cacheSize }} max_size=1g inactive=60m use_temp_path=off ; location / { proxy_cache my_cache ; proxy_cache_revalidate on ; proxy_cache_min_uses 3 ; proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504 ; proxy_cache_background_update on ; proxy_cache_lock on ; }","title":"\uce90\uc2dc \uc124\uc815"},{"location":"configuration/#_9","text":"","title":"\ub85c\uae45 \uc124\uc815"},{"location":"configuration/#_10","text":"{% if values.logFormat == \"json\" %} JSON \ud615\uc2dd \ub85c\uadf8: 1 2 3 4 5 6 7 8 9 10 11 12 13 log_format json_combined escape=json ' { ' '\"time_local\":\" $time_local\",' '\"remote_addr\":\" $remote_addr\",' '\"request\":\" $request\",' '\"status\": \" $status\",' '\"body_bytes_sent\":\" $body_bytes_sent\",' '\"request_time\":\" $request_time\",' '\"http_referrer\":\" $http_referer\",' '\"http_user_agent\":\" $http_user_agent\"' ' } ' ; access_log /var/log/nginx/access.log json_combined ; {% else %} \ud45c\uc900 \ud615\uc2dd \ub85c\uadf8: 1 2 3 4 5 log_format combined ' $remote_addr - $remote_user [ $time_local] ' '\" $request\" $status $body_bytes_sent ' '\" $http_referer\" \" $http_user_agent\"' ; access_log /var/log/nginx/access.log combined ;","title":"\uc811\uadfc \ub85c\uadf8 \ud615\uc2dd"},{"location":"configuration/#_11","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # logrotate \uc124\uc815 (/etc/logrotate.d/nginx) /var/log/nginx/*.log { daily missingok rotate 52 compress delaycompress notifempty create 644 nginx nginx postrotate if [ -f /var/run/nginx.pid ] ; then kill -USR1 ` cat /var/run/nginx.pid ` fi endscript }","title":"\ub85c\uadf8 \ub85c\ud14c\uc774\uc158"},{"location":"configuration/#_12","text":"\uc124\uc815 \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 Troubleshooting \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.","title":"\ubb38\uc81c \ud574\uacb0"},{"location":"deployment/","text":"Deployment Guide \u00b6 \uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\ub97c \ub2e4\uc591\ud55c \ud658\uacbd\uc5d0 \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4. \ubc30\ud3ec \uc635\uc158 \u00b6 {% if values.deploymentType == \"docker-compose\" or values.deploymentType == \"both\" %} Docker Compose \ubc30\ud3ec \u00b6 \ub85c\uceec \uac1c\ubc1c \ud658\uacbd \u00b6 1 2 3 4 5 6 7 8 9 10 # \ud658\uacbd \ubcc0\uc218 \uc124\uc815 cp .env.example .env vim .env # \uc11c\ube44\uc2a4 \uc2dc\uc791 docker-compose up -d # \uc0c1\ud0dc \ud655\uc778 docker-compose ps docker-compose logs -f nginx \ud504\ub85c\ub355\uc158 \ud658\uacbd \u00b6 \ud504\ub85c\ub355\uc158\uc6a9 docker-compose.prod.yml \ud30c\uc77c: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 version : '3.8' services : nginx : image : nginx:${{ values.nginxVersion }} container_name : ${{ values.name }} restart : unless-stopped ports : - \"${{ values.port }}:80\" { % if values.enableSSL % } - \"443:443\" { % endif % } volumes : - ./config/nginx.conf:/etc/nginx/nginx.conf:ro - ./config/default.conf:/etc/nginx/conf.d/default.conf:ro - ./html:/usr/share/nginx/html:ro { % if values.enableSSL % } - ./ssl:/etc/nginx/ssl:ro { % endif % } - nginx_logs:/var/log/nginx { % if values.enableMonitoring % } labels : - \"prometheus.io/scrape=true\" - \"prometheus.io/port=9114\" { % endif % } networks : - nginx_network { % if values.enableMonitoring % } nginx-exporter : image : nginx/nginx-prometheus-exporter:latest container_name : ${{ values.name }}-exporter restart : unless-stopped ports : - \"9114:9114\" command : - '-nginx.scrape-uri=http://nginx:80/nginx_status' depends_on : - nginx networks : - nginx_network { % endif % } volumes : nginx_logs : networks : nginx_network : driver : bridge \ubc30\ud3ec \uba85\ub839: 1 2 3 4 5 6 # \ud504\ub85c\ub355\uc158 \ubc30\ud3ec docker-compose -f docker-compose.prod.yml up -d # \uc5c5\ub370\uc774\ud2b8 \ubc30\ud3ec docker-compose -f docker-compose.prod.yml pull docker-compose -f docker-compose.prod.yml up -d --force-recreate {% if values.deploymentType == \"kubernetes\" or values.deploymentType == \"both\" %} Kubernetes \ubc30\ud3ec \u00b6 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc0dd\uc131 \u00b6 1 kubectl create namespace ${ { values.namespace } } ConfigMap \ubc30\ud3ec \u00b6 1 kubectl apply -f k8s/configmap.yaml -n ${ { values.namespace } } Secret \ubc30\ud3ec (SSL \uc778\uc99d\uc11c) \u00b6 {% if values.enableSSL %} 1 2 3 4 5 # TLS \uc2dc\ud06c\ub9bf \uc0dd\uc131 kubectl create secret tls ${ { values.name } } -tls \\ --cert = path/to/tls.crt \\ --key = path/to/tls.key \\ -n ${ { values.namespace } } \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec \u00b6 1 2 3 4 5 6 7 # \uc804\uccb4 \ub9e4\ub2c8\ud398\uc2a4\ud2b8 \ubc30\ud3ec kubectl apply -f k8s/ -n ${ { values.namespace } } # \uac1c\ubcc4 \ub9ac\uc18c\uc2a4 \ubc30\ud3ec kubectl apply -f k8s/deployment.yaml -n ${ { values.namespace } } kubectl apply -f k8s/service.yaml -n ${ { values.namespace } } kubectl apply -f k8s/ingress.yaml -n ${ { values.namespace } } \ubc30\ud3ec \uc0c1\ud0dc \ud655\uc778 \u00b6 1 2 3 4 5 6 7 8 9 10 11 # Pod \uc0c1\ud0dc \ud655\uc778 kubectl get pods -n ${ { values.namespace } } # \uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 kubectl get svc -n ${ { values.namespace } } # Ingress \uc0c1\ud0dc \ud655\uc778 kubectl get ingress -n ${ { values.namespace } } # \ub85c\uadf8 \ud655\uc778 kubectl logs -f deployment/ ${ { values.name } } -n ${ { values.namespace } } Helm \ubc30\ud3ec (\uc120\ud0dd\uc0ac\ud56d) \u00b6 Helm \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud55c \ubc30\ud3ec: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Helm \ucc28\ud2b8 \uc0dd\uc131 helm create ${ { values.name } } # values.yaml \ud3b8\uc9d1 vim ${ { values.name } } /values.yaml # \ubc30\ud3ec helm install ${ { values.name } } ./ ${ { values.name } } -n ${ { values.namespace } } # \uc5c5\uadf8\ub808\uc774\ub4dc helm upgrade ${ { values.name } } ./ ${ { values.name } } -n ${ { values.namespace } } # \uc0c1\ud0dc \ud655\uc778 helm status ${ { values.name } } -n ${ { values.namespace } } CI/CD \ud30c\uc774\ud504\ub77c\uc778 \u00b6 GitHub Actions \u00b6 .github/workflows/deploy.yml : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 name : Deploy NGINX Service on : push : branches : [ main ] pull_request : branches : [ main ] jobs : test : runs-on : ubuntu-latest steps : - uses : actions/checkout@v3 - name : Test NGINX Configuration run : | docker run --rm -v $PWD/config:/etc/nginx/conf.d nginx:${{ values.nginxVersion }} nginx -t { % if values.deploymentType == \"docker-compose\" or values.deploymentType == \"both\" % } deploy-docker : needs : test runs-on : ubuntu-latest if : github.ref == 'refs/heads/main' steps : - uses : actions/checkout@v3 - name : Deploy to Docker Compose run : | docker-compose -f docker-compose.prod.yml pull docker-compose -f docker-compose.prod.yml up -d { % endif % } { % if values.deploymentType == \"kubernetes\" or values.deploymentType == \"both\" % } deploy-k8s : needs : test runs-on : ubuntu-latest if : github.ref == 'refs/heads/main' steps : - uses : actions/checkout@v3 - name : Setup kubectl uses : azure/setup-kubectl@v1 with : version : 'latest' - name : Deploy to Kubernetes run : | kubectl apply -f k8s/ -n ${{ values.namespace }} kubectl rollout status deployment/${{ values.name }} -n ${{ values.namespace }} { % endif % } GitLab CI \u00b6 .gitlab-ci.yml : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 stages : - test - deploy variables : DOCKER_DRIVER : overlay2 test : stage : test image : nginx:${{ values.nginxVersion }} script : - nginx -t -c /builds/$CI_PROJECT_PATH/config/nginx.conf { % if values.deploymentType == \"docker-compose\" or values.deploymentType == \"both\" % } deploy-docker : stage : deploy image : docker:latest services : - docker:dind script : - docker-compose -f docker-compose.prod.yml up -d only : - main { % endif % } { % if values.deploymentType == \"kubernetes\" or values.deploymentType == \"both\" % } deploy-k8s : stage : deploy image : bitnami/kubectl:latest script : - kubectl apply -f k8s/ -n ${{ values.namespace }} - kubectl rollout status deployment/${{ values.name }} -n ${{ values.namespace }} only : - main { % endif % } \ubc30\ud3ec \uc804\ub7b5 \u00b6 Blue-Green \ubc30\ud3ec \u00b6 1 2 3 4 5 6 7 8 9 10 11 # Green \ud658\uacbd \ubc30\ud3ec kubectl apply -f k8s/ -n ${ { values.namespace } } -green # \ud2b8\ub798\ud53d \uc804\ud658 \uc804 \ud14c\uc2a4\ud2b8 kubectl port-forward svc/ ${ { values.name } } 8080 :80 -n ${ { values.namespace } } -green # \ud2b8\ub798\ud53d \uc804\ud658 kubectl patch service ${ { values.name } } -p '{\"spec\":{\"selector\":{\"version\":\"green\"}}}' -n ${ { values.namespace } } # Blue \ud658\uacbd \uc815\ub9ac kubectl delete namespace ${ { values.namespace } } -blue Rolling Update \u00b6 1 2 3 4 5 6 7 8 # \uc774\ubbf8\uc9c0 \uc5c5\ub370\uc774\ud2b8 kubectl set image deployment/ ${ { values.name } } nginx = nginx: ${ { values.nginxVersion } } -n ${ { values.namespace } } # \ub864\uc544\uc6c3 \uc0c1\ud0dc \ud655\uc778 kubectl rollout status deployment/ ${ { values.name } } -n ${ { values.namespace } } # \ub864\ubc31 (\ud544\uc694\uc2dc) kubectl rollout undo deployment/ ${ { values.name } } -n ${ { values.namespace } } Canary \ubc30\ud3ec \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # canary-deployment.yaml apiVersion : apps/v1 kind : Deployment metadata : name : ${{ values.name }}-canary spec : replicas : 1 # \uc804\uccb4 \ud2b8\ub798\ud53d\uc758 10% selector : matchLabels : app : ${{ values.name }} version : canary template : metadata : labels : app : ${{ values.name }} version : canary spec : containers : - name : nginx image : nginx:${{ values.nginxVersion }} # \uc0c8 \ubc84\uc804 \uc124\uc815 \ud658\uacbd\ubcc4 \uc124\uc815 \u00b6 \uac1c\ubc1c \ud658\uacbd \u00b6 1 2 3 4 # \uac1c\ubc1c\uc6a9 \ud658\uacbd \ubcc0\uc218 export ENVIRONMENT = development export DEBUG = true export LOG_LEVEL = debug \uc2a4\ud14c\uc774\uc9d5 \ud658\uacbd \u00b6 1 2 3 4 # \uc2a4\ud14c\uc774\uc9d5\uc6a9 \ud658\uacbd \ubcc0\uc218 export ENVIRONMENT = staging export DEBUG = false export LOG_LEVEL = info \ud504\ub85c\ub355\uc158 \ud658\uacbd \u00b6 1 2 3 4 # \ud504\ub85c\ub355\uc158\uc6a9 \ud658\uacbd \ubcc0\uc218 export ENVIRONMENT = production export DEBUG = false export LOG_LEVEL = warn \ubc31\uc5c5 \ubc0f \ubcf5\uad6c \u00b6 \uc124\uc815 \ubc31\uc5c5 \u00b6 1 2 3 4 5 # \uc124\uc815 \ud30c\uc77c \ubc31\uc5c5 tar -czf nginx-config-backup- $( date +%Y%m%d ) .tar.gz config/ # Kubernetes \ub9ac\uc18c\uc2a4 \ubc31\uc5c5 kubectl get all -n ${ { values.namespace } } -o yaml > k8s-backup- $( date +%Y%m%d ) .yaml \ubcf5\uad6c \uc808\ucc28 \u00b6 1 2 3 4 5 # \uc124\uc815 \ubcf5\uad6c tar -xzf nginx-config-backup-YYYYMMDD.tar.gz # Kubernetes \ub9ac\uc18c\uc2a4 \ubcf5\uad6c kubectl apply -f k8s-backup-YYYYMMDD.yaml \uc131\ub2a5 \ucd5c\uc801\ud654 \u00b6 \ub9ac\uc18c\uc2a4 \ud560\ub2f9 \u00b6 1 2 3 4 5 6 7 8 # Kubernetes \ub9ac\uc18c\uc2a4 \uc81c\ud55c resources : requests : memory : \"64Mi\" cpu : \"250m\" limits : memory : \"128Mi\" cpu : \"500m\" \uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # HPA \uc124\uc815 apiVersion : autoscaling/v2 kind : HorizontalPodAutoscaler metadata : name : ${{ values.name }}-hpa spec : scaleTargetRef : apiVersion : apps/v1 kind : Deployment name : ${{ values.name }} minReplicas : ${{ values.replicas }} maxReplicas : 10 metrics : - type : Resource resource : name : cpu target : type : Utilization averageUtilization : 70 \ubb38\uc81c \ud574\uacb0 \u00b6 \ubc30\ud3ec \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74: Troubleshooting \uac00\uc774\ub4dc \ud655\uc778 \ub85c\uadf8 \ubd84\uc11d: kubectl logs -f deployment/${{ values.name }} -n ${{ values.namespace }} \uc774\ubca4\ud2b8 \ud655\uc778: kubectl get events -n ${{ values.namespace }} \ub9ac\uc18c\uc2a4 \uc0c1\ud0dc \ud655\uc778: kubectl describe deployment/${{ values.name }} -n ${{ values.namespace }}","title":"Deployment"},{"location":"deployment/#deployment-guide","text":"\uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\ub97c \ub2e4\uc591\ud55c \ud658\uacbd\uc5d0 \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.","title":"Deployment Guide"},{"location":"deployment/#_1","text":"{% if values.deploymentType == \"docker-compose\" or values.deploymentType == \"both\" %}","title":"\ubc30\ud3ec \uc635\uc158"},{"location":"deployment/#docker-compose","text":"","title":"Docker Compose \ubc30\ud3ec"},{"location":"deployment/#_2","text":"1 2 3 4 5 6 7 8 9 10 # \ud658\uacbd \ubcc0\uc218 \uc124\uc815 cp .env.example .env vim .env # \uc11c\ube44\uc2a4 \uc2dc\uc791 docker-compose up -d # \uc0c1\ud0dc \ud655\uc778 docker-compose ps docker-compose logs -f nginx","title":"\ub85c\uceec \uac1c\ubc1c \ud658\uacbd"},{"location":"deployment/#_3","text":"\ud504\ub85c\ub355\uc158\uc6a9 docker-compose.prod.yml \ud30c\uc77c: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 version : '3.8' services : nginx : image : nginx:${{ values.nginxVersion }} container_name : ${{ values.name }} restart : unless-stopped ports : - \"${{ values.port }}:80\" { % if values.enableSSL % } - \"443:443\" { % endif % } volumes : - ./config/nginx.conf:/etc/nginx/nginx.conf:ro - ./config/default.conf:/etc/nginx/conf.d/default.conf:ro - ./html:/usr/share/nginx/html:ro { % if values.enableSSL % } - ./ssl:/etc/nginx/ssl:ro { % endif % } - nginx_logs:/var/log/nginx { % if values.enableMonitoring % } labels : - \"prometheus.io/scrape=true\" - \"prometheus.io/port=9114\" { % endif % } networks : - nginx_network { % if values.enableMonitoring % } nginx-exporter : image : nginx/nginx-prometheus-exporter:latest container_name : ${{ values.name }}-exporter restart : unless-stopped ports : - \"9114:9114\" command : - '-nginx.scrape-uri=http://nginx:80/nginx_status' depends_on : - nginx networks : - nginx_network { % endif % } volumes : nginx_logs : networks : nginx_network : driver : bridge \ubc30\ud3ec \uba85\ub839: 1 2 3 4 5 6 # \ud504\ub85c\ub355\uc158 \ubc30\ud3ec docker-compose -f docker-compose.prod.yml up -d # \uc5c5\ub370\uc774\ud2b8 \ubc30\ud3ec docker-compose -f docker-compose.prod.yml pull docker-compose -f docker-compose.prod.yml up -d --force-recreate {% if values.deploymentType == \"kubernetes\" or values.deploymentType == \"both\" %}","title":"\ud504\ub85c\ub355\uc158 \ud658\uacbd"},{"location":"deployment/#kubernetes","text":"","title":"Kubernetes \ubc30\ud3ec"},{"location":"deployment/#_4","text":"1 kubectl create namespace ${ { values.namespace } }","title":"\ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc0dd\uc131"},{"location":"deployment/#configmap","text":"1 kubectl apply -f k8s/configmap.yaml -n ${ { values.namespace } }","title":"ConfigMap \ubc30\ud3ec"},{"location":"deployment/#secret-ssl","text":"{% if values.enableSSL %} 1 2 3 4 5 # TLS \uc2dc\ud06c\ub9bf \uc0dd\uc131 kubectl create secret tls ${ { values.name } } -tls \\ --cert = path/to/tls.crt \\ --key = path/to/tls.key \\ -n ${ { values.namespace } }","title":"Secret \ubc30\ud3ec (SSL \uc778\uc99d\uc11c)"},{"location":"deployment/#_5","text":"1 2 3 4 5 6 7 # \uc804\uccb4 \ub9e4\ub2c8\ud398\uc2a4\ud2b8 \ubc30\ud3ec kubectl apply -f k8s/ -n ${ { values.namespace } } # \uac1c\ubcc4 \ub9ac\uc18c\uc2a4 \ubc30\ud3ec kubectl apply -f k8s/deployment.yaml -n ${ { values.namespace } } kubectl apply -f k8s/service.yaml -n ${ { values.namespace } } kubectl apply -f k8s/ingress.yaml -n ${ { values.namespace } }","title":"\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec"},{"location":"deployment/#_6","text":"1 2 3 4 5 6 7 8 9 10 11 # Pod \uc0c1\ud0dc \ud655\uc778 kubectl get pods -n ${ { values.namespace } } # \uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 kubectl get svc -n ${ { values.namespace } } # Ingress \uc0c1\ud0dc \ud655\uc778 kubectl get ingress -n ${ { values.namespace } } # \ub85c\uadf8 \ud655\uc778 kubectl logs -f deployment/ ${ { values.name } } -n ${ { values.namespace } }","title":"\ubc30\ud3ec \uc0c1\ud0dc \ud655\uc778"},{"location":"deployment/#helm","text":"Helm \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud55c \ubc30\ud3ec: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Helm \ucc28\ud2b8 \uc0dd\uc131 helm create ${ { values.name } } # values.yaml \ud3b8\uc9d1 vim ${ { values.name } } /values.yaml # \ubc30\ud3ec helm install ${ { values.name } } ./ ${ { values.name } } -n ${ { values.namespace } } # \uc5c5\uadf8\ub808\uc774\ub4dc helm upgrade ${ { values.name } } ./ ${ { values.name } } -n ${ { values.namespace } } # \uc0c1\ud0dc \ud655\uc778 helm status ${ { values.name } } -n ${ { values.namespace } }","title":"Helm \ubc30\ud3ec (\uc120\ud0dd\uc0ac\ud56d)"},{"location":"deployment/#cicd","text":"","title":"CI/CD \ud30c\uc774\ud504\ub77c\uc778"},{"location":"deployment/#github-actions","text":".github/workflows/deploy.yml : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 name : Deploy NGINX Service on : push : branches : [ main ] pull_request : branches : [ main ] jobs : test : runs-on : ubuntu-latest steps : - uses : actions/checkout@v3 - name : Test NGINX Configuration run : | docker run --rm -v $PWD/config:/etc/nginx/conf.d nginx:${{ values.nginxVersion }} nginx -t { % if values.deploymentType == \"docker-compose\" or values.deploymentType == \"both\" % } deploy-docker : needs : test runs-on : ubuntu-latest if : github.ref == 'refs/heads/main' steps : - uses : actions/checkout@v3 - name : Deploy to Docker Compose run : | docker-compose -f docker-compose.prod.yml pull docker-compose -f docker-compose.prod.yml up -d { % endif % } { % if values.deploymentType == \"kubernetes\" or values.deploymentType == \"both\" % } deploy-k8s : needs : test runs-on : ubuntu-latest if : github.ref == 'refs/heads/main' steps : - uses : actions/checkout@v3 - name : Setup kubectl uses : azure/setup-kubectl@v1 with : version : 'latest' - name : Deploy to Kubernetes run : | kubectl apply -f k8s/ -n ${{ values.namespace }} kubectl rollout status deployment/${{ values.name }} -n ${{ values.namespace }} { % endif % }","title":"GitHub Actions"},{"location":"deployment/#gitlab-ci","text":".gitlab-ci.yml : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 stages : - test - deploy variables : DOCKER_DRIVER : overlay2 test : stage : test image : nginx:${{ values.nginxVersion }} script : - nginx -t -c /builds/$CI_PROJECT_PATH/config/nginx.conf { % if values.deploymentType == \"docker-compose\" or values.deploymentType == \"both\" % } deploy-docker : stage : deploy image : docker:latest services : - docker:dind script : - docker-compose -f docker-compose.prod.yml up -d only : - main { % endif % } { % if values.deploymentType == \"kubernetes\" or values.deploymentType == \"both\" % } deploy-k8s : stage : deploy image : bitnami/kubectl:latest script : - kubectl apply -f k8s/ -n ${{ values.namespace }} - kubectl rollout status deployment/${{ values.name }} -n ${{ values.namespace }} only : - main { % endif % }","title":"GitLab CI"},{"location":"deployment/#_7","text":"","title":"\ubc30\ud3ec \uc804\ub7b5"},{"location":"deployment/#blue-green","text":"1 2 3 4 5 6 7 8 9 10 11 # Green \ud658\uacbd \ubc30\ud3ec kubectl apply -f k8s/ -n ${ { values.namespace } } -green # \ud2b8\ub798\ud53d \uc804\ud658 \uc804 \ud14c\uc2a4\ud2b8 kubectl port-forward svc/ ${ { values.name } } 8080 :80 -n ${ { values.namespace } } -green # \ud2b8\ub798\ud53d \uc804\ud658 kubectl patch service ${ { values.name } } -p '{\"spec\":{\"selector\":{\"version\":\"green\"}}}' -n ${ { values.namespace } } # Blue \ud658\uacbd \uc815\ub9ac kubectl delete namespace ${ { values.namespace } } -blue","title":"Blue-Green \ubc30\ud3ec"},{"location":"deployment/#rolling-update","text":"1 2 3 4 5 6 7 8 # \uc774\ubbf8\uc9c0 \uc5c5\ub370\uc774\ud2b8 kubectl set image deployment/ ${ { values.name } } nginx = nginx: ${ { values.nginxVersion } } -n ${ { values.namespace } } # \ub864\uc544\uc6c3 \uc0c1\ud0dc \ud655\uc778 kubectl rollout status deployment/ ${ { values.name } } -n ${ { values.namespace } } # \ub864\ubc31 (\ud544\uc694\uc2dc) kubectl rollout undo deployment/ ${ { values.name } } -n ${ { values.namespace } }","title":"Rolling Update"},{"location":"deployment/#canary","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # canary-deployment.yaml apiVersion : apps/v1 kind : Deployment metadata : name : ${{ values.name }}-canary spec : replicas : 1 # \uc804\uccb4 \ud2b8\ub798\ud53d\uc758 10% selector : matchLabels : app : ${{ values.name }} version : canary template : metadata : labels : app : ${{ values.name }} version : canary spec : containers : - name : nginx image : nginx:${{ values.nginxVersion }} # \uc0c8 \ubc84\uc804 \uc124\uc815","title":"Canary \ubc30\ud3ec"},{"location":"deployment/#_8","text":"","title":"\ud658\uacbd\ubcc4 \uc124\uc815"},{"location":"deployment/#_9","text":"1 2 3 4 # \uac1c\ubc1c\uc6a9 \ud658\uacbd \ubcc0\uc218 export ENVIRONMENT = development export DEBUG = true export LOG_LEVEL = debug","title":"\uac1c\ubc1c \ud658\uacbd"},{"location":"deployment/#_10","text":"1 2 3 4 # \uc2a4\ud14c\uc774\uc9d5\uc6a9 \ud658\uacbd \ubcc0\uc218 export ENVIRONMENT = staging export DEBUG = false export LOG_LEVEL = info","title":"\uc2a4\ud14c\uc774\uc9d5 \ud658\uacbd"},{"location":"deployment/#_11","text":"1 2 3 4 # \ud504\ub85c\ub355\uc158\uc6a9 \ud658\uacbd \ubcc0\uc218 export ENVIRONMENT = production export DEBUG = false export LOG_LEVEL = warn","title":"\ud504\ub85c\ub355\uc158 \ud658\uacbd"},{"location":"deployment/#_12","text":"","title":"\ubc31\uc5c5 \ubc0f \ubcf5\uad6c"},{"location":"deployment/#_13","text":"1 2 3 4 5 # \uc124\uc815 \ud30c\uc77c \ubc31\uc5c5 tar -czf nginx-config-backup- $( date +%Y%m%d ) .tar.gz config/ # Kubernetes \ub9ac\uc18c\uc2a4 \ubc31\uc5c5 kubectl get all -n ${ { values.namespace } } -o yaml > k8s-backup- $( date +%Y%m%d ) .yaml","title":"\uc124\uc815 \ubc31\uc5c5"},{"location":"deployment/#_14","text":"1 2 3 4 5 # \uc124\uc815 \ubcf5\uad6c tar -xzf nginx-config-backup-YYYYMMDD.tar.gz # Kubernetes \ub9ac\uc18c\uc2a4 \ubcf5\uad6c kubectl apply -f k8s-backup-YYYYMMDD.yaml","title":"\ubcf5\uad6c \uc808\ucc28"},{"location":"deployment/#_15","text":"","title":"\uc131\ub2a5 \ucd5c\uc801\ud654"},{"location":"deployment/#_16","text":"1 2 3 4 5 6 7 8 # Kubernetes \ub9ac\uc18c\uc2a4 \uc81c\ud55c resources : requests : memory : \"64Mi\" cpu : \"250m\" limits : memory : \"128Mi\" cpu : \"500m\"","title":"\ub9ac\uc18c\uc2a4 \ud560\ub2f9"},{"location":"deployment/#_17","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # HPA \uc124\uc815 apiVersion : autoscaling/v2 kind : HorizontalPodAutoscaler metadata : name : ${{ values.name }}-hpa spec : scaleTargetRef : apiVersion : apps/v1 kind : Deployment name : ${{ values.name }} minReplicas : ${{ values.replicas }} maxReplicas : 10 metrics : - type : Resource resource : name : cpu target : type : Utilization averageUtilization : 70","title":"\uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1"},{"location":"deployment/#_18","text":"\ubc30\ud3ec \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74: Troubleshooting \uac00\uc774\ub4dc \ud655\uc778 \ub85c\uadf8 \ubd84\uc11d: kubectl logs -f deployment/${{ values.name }} -n ${{ values.namespace }} \uc774\ubca4\ud2b8 \ud655\uc778: kubectl get events -n ${{ values.namespace }} \ub9ac\uc18c\uc2a4 \uc0c1\ud0dc \ud655\uc778: kubectl describe deployment/${{ values.name }} -n ${{ values.namespace }}","title":"\ubb38\uc81c \ud574\uacb0"},{"location":"getting-started/","text":"Getting Started \u00b6 \uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\ub97c \ub85c\uceec\uc5d0\uc11c \uac1c\ubc1c\ud558\uace0 \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4. \uc0ac\uc804 \uc694\uad6c\uc0ac\ud56d \u00b6 \ud544\uc218 \ub3c4\uad6c \u00b6 Docker \ubc0f Docker Compose kubectl (Kubernetes CLI) Helm (\uc120\ud0dd\uc0ac\ud56d) Git \uad8c\uc7a5 \ub3c4\uad6c \u00b6 Visual Studio Code NGINX \uc124\uc815 \ubb38\ubc95 \ud558\uc774\ub77c\uc774\ud130 \ub85c\uceec \uac1c\ubc1c \ud658\uacbd \uc124\uc815 \u00b6 1. \uc800\uc7a5\uc18c \ud074\ub860 \u00b6 1 2 git clone ${ { values.owner } } / ${ { values.repo } } .git cd ${ { values.repo } } 2. \ud658\uacbd \ubcc0\uc218 \uc124\uc815 \u00b6 1 cp .env.example .env .env \ud30c\uc77c\uc744 \ud3b8\uc9d1\ud558\uc5ec \ud658\uacbd\uc5d0 \ub9de\ub294 \uac12\uc744 \uc124\uc815\ud558\uc138\uc694: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # \uae30\ubcf8 \uc124\uc815 SERVICE_NAME = ${ { values.name } } SERVICE_PORT = ${ { values.port } } NGINX_VERSION = ${ { values.nginxVersion } } { % if values.domain % } # \ub3c4\uba54\uc778 \uc124\uc815 DOMAIN = ${ { values.domain } } { % if values.additionalDomains % } ADDITIONAL_DOMAINS = ${ { values.additionalDomains | join( ',' ) } } { % endif % } { % endif % } { % if values.enableSSL % } # SSL \uc124\uc815 SSL_ENABLED = true SSL_PROVIDER = ${ { values.sslProvider } } { % endif % } { % if values.enableMonitoring % } # \ubaa8\ub2c8\ud130\ub9c1 \uc124\uc815 MONITORING_ENABLED = true { % endif % } 3. Docker Compose\ub85c \ub85c\uceec \uc2e4\ud589 \u00b6 1 2 3 4 5 6 7 8 # \uc11c\ube44\uc2a4 \uc2dc\uc791 docker-compose up -d # \ub85c\uadf8 \ud655\uc778 docker-compose logs -f nginx # \uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 docker-compose ps 4. \uc11c\ube44\uc2a4 \uc811\uc18d \ud655\uc778 \u00b6 {% if values.enableSSL and values.domain %} \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c https://${{ values.domain }} \ub85c \uc811\uc18d\ud558\uc5ec \uc11c\ube44\uc2a4\uac00 \uc815\uc0c1 \ub3d9\uc791\ud558\ub294\uc9c0 \ud655\uc778\ud558\uc138\uc694. {% else %} \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c http://localhost:${{ values.port }} \ub85c \uc811\uc18d\ud558\uc5ec \uc11c\ube44\uc2a4\uac00 \uc815\uc0c1 \ub3d9\uc791\ud558\ub294\uc9c0 \ud655\uc778\ud558\uc138\uc694. {% if values.enableMonitoring %} 5. \ubaa8\ub2c8\ud130\ub9c1 \ud655\uc778 \u00b6 Prometheus \uba54\ud2b8\ub9ad\uc740 \ub2e4\uc74c URL\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4: - \uba54\ud2b8\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8: http://localhost:9114/metrics \ud504\ub85c\uc81d\ud2b8 \uad6c\uc870 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ${{ values.repo }}/ \u251c\u2500\u2500 config/ # NGINX \uc124\uc815 \ud30c\uc77c \u2502 \u251c\u2500\u2500 nginx.conf # \uba54\uc778 NGINX \uc124\uc815 \u2502 \u2514\u2500\u2500 default.conf # \uae30\ubcf8 \uc0ac\uc774\ud2b8 \uc124\uc815 \u251c\u2500\u2500 html/ # \uc6f9 \ucf58\ud150\uce20 (\uc815\uc801 \ud30c\uc77c) \u2502 \u251c\u2500\u2500 index.html \u2502 \u2514\u2500\u2500 errors/ # \ucee4\uc2a4\ud140 \uc5d0\ub7ec \ud398\uc774\uc9c0 \u251c\u2500\u2500 k8s/ # Kubernetes \ub9e4\ub2c8\ud398\uc2a4\ud2b8 \u2502 \u251c\u2500\u2500 deployment.yaml \u2502 \u251c\u2500\u2500 service.yaml \u2502 \u251c\u2500\u2500 ingress.yaml \u2502 \u2514\u2500\u2500 configmap.yaml \u251c\u2500\u2500 docker-compose.yml # Docker Compose \uc124\uc815 \u251c\u2500\u2500 Dockerfile # Docker \uc774\ubbf8\uc9c0 \ube4c\ub4dc \uc124\uc815 \u251c\u2500\u2500 .env.example # \ud658\uacbd \ubcc0\uc218 \ud15c\ud50c\ub9bf \u2514\u2500\u2500 README.md # \ud504\ub85c\uc81d\ud2b8 \uac1c\uc694 \uac1c\ubc1c \uc6cc\ud06c\ud50c\ub85c\uc6b0 \u00b6 1. \uc124\uc815 \ubcc0\uacbd \u00b6 NGINX \uc124\uc815\uc744 \ubcc0\uacbd\ud558\ub824\uba74: config/nginx.conf \ub610\ub294 config/default.conf \ud30c\uc77c\uc744 \ud3b8\uc9d1 \uc124\uc815 \ubb38\ubc95 \uac80\uc99d: docker-compose exec nginx nginx -t \uc124\uc815 \ub9ac\ub85c\ub4dc: docker-compose exec nginx nginx -s reload 2. \ucf58\ud150\uce20 \uc5c5\ub370\uc774\ud2b8 \u00b6 {% if values.serviceType == \"static-site\" %} \uc815\uc801 \ucf58\ud150\uce20\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\ub824\uba74: html/ \ub514\ub809\ud1a0\ub9ac\uc758 \ud30c\uc77c\uc744 \ud3b8\uc9d1 \ubcc0\uacbd\uc0ac\ud56d\uc774 \uc989\uc2dc \ubc18\uc601\ub428 (\ubcfc\ub968 \ub9c8\uc6b4\ud2b8) {% elif values.serviceType == \"reverse-proxy\" %} \ubc31\uc5d4\ub4dc \uc11c\ube44\uc2a4 \uc124\uc815\uc744 \ubcc0\uacbd\ud558\ub824\uba74: config/default.conf \uc758 upstream \uc124\uc815\uc744 \ud3b8\uc9d1 NGINX \uc124\uc815 \ub9ac\ub85c\ub4dc 3. \ub85c\uadf8 \ubaa8\ub2c8\ud130\ub9c1 \u00b6 1 2 3 4 5 6 7 8 # \uc2e4\uc2dc\uac04 \ub85c\uadf8 \ud655\uc778 docker-compose logs -f nginx # \uc811\uadfc \ub85c\uadf8\ub9cc \ud655\uc778 docker-compose exec nginx tail -f /var/log/nginx/access.log # \uc5d0\ub7ec \ub85c\uadf8\ub9cc \ud655\uc778 docker-compose exec nginx tail -f /var/log/nginx/error.log \ub2e4\uc74c \ub2e8\uacc4 \u00b6 Configuration - \uc0c1\uc138 \uc124\uc815 \uc635\uc158 \uc54c\uc544\ubcf4\uae30 Deployment - \ud504\ub85c\ub355\uc158 \ubc30\ud3ec \uac00\uc774\ub4dc Monitoring - \ubaa8\ub2c8\ud130\ub9c1 \uc124\uc815\ud558\uae30 Security - \ubcf4\uc548 \uac15\ud654 \ubc29\ubc95","title":"Getting Started"},{"location":"getting-started/#getting-started","text":"\uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\ub97c \ub85c\uceec\uc5d0\uc11c \uac1c\ubc1c\ud558\uace0 \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.","title":"Getting Started"},{"location":"getting-started/#_1","text":"","title":"\uc0ac\uc804 \uc694\uad6c\uc0ac\ud56d"},{"location":"getting-started/#_2","text":"Docker \ubc0f Docker Compose kubectl (Kubernetes CLI) Helm (\uc120\ud0dd\uc0ac\ud56d) Git","title":"\ud544\uc218 \ub3c4\uad6c"},{"location":"getting-started/#_3","text":"Visual Studio Code NGINX \uc124\uc815 \ubb38\ubc95 \ud558\uc774\ub77c\uc774\ud130","title":"\uad8c\uc7a5 \ub3c4\uad6c"},{"location":"getting-started/#_4","text":"","title":"\ub85c\uceec \uac1c\ubc1c \ud658\uacbd \uc124\uc815"},{"location":"getting-started/#1","text":"1 2 git clone ${ { values.owner } } / ${ { values.repo } } .git cd ${ { values.repo } }","title":"1. \uc800\uc7a5\uc18c \ud074\ub860"},{"location":"getting-started/#2","text":"1 cp .env.example .env .env \ud30c\uc77c\uc744 \ud3b8\uc9d1\ud558\uc5ec \ud658\uacbd\uc5d0 \ub9de\ub294 \uac12\uc744 \uc124\uc815\ud558\uc138\uc694: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # \uae30\ubcf8 \uc124\uc815 SERVICE_NAME = ${ { values.name } } SERVICE_PORT = ${ { values.port } } NGINX_VERSION = ${ { values.nginxVersion } } { % if values.domain % } # \ub3c4\uba54\uc778 \uc124\uc815 DOMAIN = ${ { values.domain } } { % if values.additionalDomains % } ADDITIONAL_DOMAINS = ${ { values.additionalDomains | join( ',' ) } } { % endif % } { % endif % } { % if values.enableSSL % } # SSL \uc124\uc815 SSL_ENABLED = true SSL_PROVIDER = ${ { values.sslProvider } } { % endif % } { % if values.enableMonitoring % } # \ubaa8\ub2c8\ud130\ub9c1 \uc124\uc815 MONITORING_ENABLED = true { % endif % }","title":"2. \ud658\uacbd \ubcc0\uc218 \uc124\uc815"},{"location":"getting-started/#3-docker-compose","text":"1 2 3 4 5 6 7 8 # \uc11c\ube44\uc2a4 \uc2dc\uc791 docker-compose up -d # \ub85c\uadf8 \ud655\uc778 docker-compose logs -f nginx # \uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 docker-compose ps","title":"3. Docker Compose\ub85c \ub85c\uceec \uc2e4\ud589"},{"location":"getting-started/#4","text":"{% if values.enableSSL and values.domain %} \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c https://${{ values.domain }} \ub85c \uc811\uc18d\ud558\uc5ec \uc11c\ube44\uc2a4\uac00 \uc815\uc0c1 \ub3d9\uc791\ud558\ub294\uc9c0 \ud655\uc778\ud558\uc138\uc694. {% else %} \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c http://localhost:${{ values.port }} \ub85c \uc811\uc18d\ud558\uc5ec \uc11c\ube44\uc2a4\uac00 \uc815\uc0c1 \ub3d9\uc791\ud558\ub294\uc9c0 \ud655\uc778\ud558\uc138\uc694. {% if values.enableMonitoring %}","title":"4. \uc11c\ube44\uc2a4 \uc811\uc18d \ud655\uc778"},{"location":"getting-started/#5","text":"Prometheus \uba54\ud2b8\ub9ad\uc740 \ub2e4\uc74c URL\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4: - \uba54\ud2b8\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8: http://localhost:9114/metrics","title":"5. \ubaa8\ub2c8\ud130\ub9c1 \ud655\uc778"},{"location":"getting-started/#_5","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ${{ values.repo }}/ \u251c\u2500\u2500 config/ # NGINX \uc124\uc815 \ud30c\uc77c \u2502 \u251c\u2500\u2500 nginx.conf # \uba54\uc778 NGINX \uc124\uc815 \u2502 \u2514\u2500\u2500 default.conf # \uae30\ubcf8 \uc0ac\uc774\ud2b8 \uc124\uc815 \u251c\u2500\u2500 html/ # \uc6f9 \ucf58\ud150\uce20 (\uc815\uc801 \ud30c\uc77c) \u2502 \u251c\u2500\u2500 index.html \u2502 \u2514\u2500\u2500 errors/ # \ucee4\uc2a4\ud140 \uc5d0\ub7ec \ud398\uc774\uc9c0 \u251c\u2500\u2500 k8s/ # Kubernetes \ub9e4\ub2c8\ud398\uc2a4\ud2b8 \u2502 \u251c\u2500\u2500 deployment.yaml \u2502 \u251c\u2500\u2500 service.yaml \u2502 \u251c\u2500\u2500 ingress.yaml \u2502 \u2514\u2500\u2500 configmap.yaml \u251c\u2500\u2500 docker-compose.yml # Docker Compose \uc124\uc815 \u251c\u2500\u2500 Dockerfile # Docker \uc774\ubbf8\uc9c0 \ube4c\ub4dc \uc124\uc815 \u251c\u2500\u2500 .env.example # \ud658\uacbd \ubcc0\uc218 \ud15c\ud50c\ub9bf \u2514\u2500\u2500 README.md # \ud504\ub85c\uc81d\ud2b8 \uac1c\uc694","title":"\ud504\ub85c\uc81d\ud2b8 \uad6c\uc870"},{"location":"getting-started/#_6","text":"","title":"\uac1c\ubc1c \uc6cc\ud06c\ud50c\ub85c\uc6b0"},{"location":"getting-started/#1_1","text":"NGINX \uc124\uc815\uc744 \ubcc0\uacbd\ud558\ub824\uba74: config/nginx.conf \ub610\ub294 config/default.conf \ud30c\uc77c\uc744 \ud3b8\uc9d1 \uc124\uc815 \ubb38\ubc95 \uac80\uc99d: docker-compose exec nginx nginx -t \uc124\uc815 \ub9ac\ub85c\ub4dc: docker-compose exec nginx nginx -s reload","title":"1. \uc124\uc815 \ubcc0\uacbd"},{"location":"getting-started/#2_1","text":"{% if values.serviceType == \"static-site\" %} \uc815\uc801 \ucf58\ud150\uce20\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\ub824\uba74: html/ \ub514\ub809\ud1a0\ub9ac\uc758 \ud30c\uc77c\uc744 \ud3b8\uc9d1 \ubcc0\uacbd\uc0ac\ud56d\uc774 \uc989\uc2dc \ubc18\uc601\ub428 (\ubcfc\ub968 \ub9c8\uc6b4\ud2b8) {% elif values.serviceType == \"reverse-proxy\" %} \ubc31\uc5d4\ub4dc \uc11c\ube44\uc2a4 \uc124\uc815\uc744 \ubcc0\uacbd\ud558\ub824\uba74: config/default.conf \uc758 upstream \uc124\uc815\uc744 \ud3b8\uc9d1 NGINX \uc124\uc815 \ub9ac\ub85c\ub4dc","title":"2. \ucf58\ud150\uce20 \uc5c5\ub370\uc774\ud2b8"},{"location":"getting-started/#3","text":"1 2 3 4 5 6 7 8 # \uc2e4\uc2dc\uac04 \ub85c\uadf8 \ud655\uc778 docker-compose logs -f nginx # \uc811\uadfc \ub85c\uadf8\ub9cc \ud655\uc778 docker-compose exec nginx tail -f /var/log/nginx/access.log # \uc5d0\ub7ec \ub85c\uadf8\ub9cc \ud655\uc778 docker-compose exec nginx tail -f /var/log/nginx/error.log","title":"3. \ub85c\uadf8 \ubaa8\ub2c8\ud130\ub9c1"},{"location":"getting-started/#_7","text":"Configuration - \uc0c1\uc138 \uc124\uc815 \uc635\uc158 \uc54c\uc544\ubcf4\uae30 Deployment - \ud504\ub85c\ub355\uc158 \ubc30\ud3ec \uac00\uc774\ub4dc Monitoring - \ubaa8\ub2c8\ud130\ub9c1 \uc124\uc815\ud558\uae30 Security - \ubcf4\uc548 \uac15\ud654 \ubc29\ubc95","title":"\ub2e4\uc74c \ub2e8\uacc4"},{"location":"monitoring/","text":"Monitoring & Observability \u00b6 \uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\uc758 \ubaa8\ub2c8\ud130\ub9c1 \ubc0f \uad00\ucc30 \uac00\ub2a5\uc131 \uc124\uc815\uc744 \uc124\uba85\ud569\ub2c8\ub2e4. {% if values.enableMonitoring %} Prometheus \uba54\ud2b8\ub9ad \u00b6 NGINX Exporter \uc124\uc815 \u00b6 NGINX Prometheus Exporter\uac00 \uc790\ub3d9\uc73c\ub85c \uc124\uc815\ub418\uc5b4 \ub2e4\uc74c \uba54\ud2b8\ub9ad\uc744 \uc218\uc9d1\ud569\ub2c8\ub2e4: \uae30\ubcf8 \uba54\ud2b8\ub9ad \u00b6 nginx_connections_active - \ud65c\uc131 \uc5f0\uacb0 \uc218 nginx_connections_reading - \uc77d\uae30 \uc911\uc778 \uc5f0\uacb0 \uc218 nginx_connections_writing - \uc4f0\uae30 \uc911\uc778 \uc5f0\uacb0 \uc218 nginx_connections_waiting - \ub300\uae30 \uc911\uc778 \uc5f0\uacb0 \uc218 nginx_http_requests_total - \ucd1d HTTP \uc694\uccad \uc218 \uc131\ub2a5 \uba54\ud2b8\ub9ad \u00b6 nginx_http_request_duration_seconds - \uc694\uccad \ucc98\ub9ac \uc2dc\uac04 nginx_http_request_size_bytes - \uc694\uccad \ud06c\uae30 nginx_http_response_size_bytes - \uc751\ub2f5 \ud06c\uae30 \uba54\ud2b8\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \u00b6 1 2 3 4 5 # \uba54\ud2b8\ub9ad \ud655\uc778 curl http://localhost:9114/metrics # \ud2b9\uc815 \uba54\ud2b8\ub9ad \ud544\ud130\ub9c1 curl http://localhost:9114/metrics | grep nginx_connections Prometheus \uc124\uc815 \u00b6 prometheus.yml \uc124\uc815 \uc608\uc2dc: 1 2 3 4 5 6 7 8 9 10 global : scrape_interval : 15s scrape_configs : - job_name : 'nginx-${{ values.name }}' static_configs : - targets : [ 'localhost:9114' ] scrape_interval : 5s metrics_path : /metrics scheme : http Grafana \ub300\uc2dc\ubcf4\ub4dc \u00b6 \ub300\uc2dc\ubcf4\ub4dc \uc124\uc815 \u00b6 Grafana\uc5d0 Prometheus \ub370\uc774\ud130\uc18c\uc2a4 \ucd94\uac00 NGINX \ub300\uc2dc\ubcf4\ub4dc \uc784\ud3ec\ud2b8 (ID: 12708) \ucee4\uc2a4\ud140 \ub300\uc2dc\ubcf4\ub4dc \uc0dd\uc131 \uc8fc\uc694 \ud328\ub110 \u00b6 \uc5f0\uacb0 \uc0c1\ud0dc \ud328\ub110 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 { \"targets\" : [ { \"expr\" : \"nginx_connections_active{job=\\\"nginx-${{ values.name }}\\\"}\" , \"legendFormat\" : \"Active Connections\" }, { \"expr\" : \"nginx_connections_waiting{job=\\\"nginx-${{ values.name }}\\\"}\" , \"legendFormat\" : \"Waiting Connections\" } ] } \uc694\uccad \ucc98\ub9ac\uc728 \ud328\ub110 \u00b6 1 2 3 4 5 6 7 8 { \"targets\" : [ { \"expr\" : \"rate(nginx_http_requests_total{job=\\\"nginx-${{ values.name }}\\\"}[5m])\" , \"legendFormat\" : \"Requests/sec\" } ] } \uc751\ub2f5 \uc2dc\uac04 \ud328\ub110 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 { \"targets\" : [ { \"expr\" : \"histogram_quantile(0.95, rate(nginx_http_request_duration_seconds_bucket{job=\\\"nginx-${{ values.name }}\\\"}[5m]))\" , \"legendFormat\" : \"95th percentile\" }, { \"expr\" : \"histogram_quantile(0.50, rate(nginx_http_request_duration_seconds_bucket{job=\\\"nginx-${{ values.name }}\\\"}[5m]))\" , \"legendFormat\" : \"50th percentile\" } ] } \ub85c\uadf8 \ubaa8\ub2c8\ud130\ub9c1 \u00b6 {% if values.enableAccessLogs %} \uc811\uadfc \ub85c\uadf8 \ubd84\uc11d \u00b6 {% if values.logFormat == \"json\" %} JSON \ud615\uc2dd \ub85c\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad6c\uc870\ud654\ub41c \ubd84\uc11d\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4: 1 2 3 4 5 6 7 8 # \uc0c1\uc704 IP \uc8fc\uc18c \ubd84\uc11d cat /var/log/nginx/access.log | jq -r '.remote_addr' | sort | uniq -c | sort -nr | head -10 # \uc751\ub2f5 \uc2dc\uac04 \ubd84\uc11d cat /var/log/nginx/access.log | jq -r '.request_time' | awk '{sum+=$1; count++} END {print \"Average:\", sum/count}' # \uc0c1\ud0dc \ucf54\ub4dc \ubd84\ud3ec cat /var/log/nginx/access.log | jq -r '.status' | sort | uniq -c | sort -nr {% else %} \ud45c\uc900 \ub85c\uadf8 \ud615\uc2dd \ubd84\uc11d: 1 2 3 4 5 6 7 8 # \uc0c1\uc704 IP \uc8fc\uc18c awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 # \uc0c1\ud0dc \ucf54\ub4dc \ubd84\ud3ec awk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -nr # \uc694\uccad URL \ubd84\uc11d awk '{print $7}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 ELK Stack \uc5f0\ub3d9 \u00b6 Filebeat \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # filebeat.yml filebeat.inputs : - type : log enabled : true paths : - /var/log/nginx/access.log { % if values.logFormat == \"json\" % } json.keys_under_root : true json.add_error_key : true { % endif % } fields : service : ${{ values.name }} environment : production output.elasticsearch : hosts : [ \"elasticsearch:9200\" ] index : \"nginx-${{ values.name }}-%{+yyyy.MM.dd}\" setup.template.name : \"nginx-${{ values.name }}\" setup.template.pattern : \"nginx-${{ values.name }}-*\" Logstash \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # logstash.conf input { beats { port => 5044 } } filter { if [ service ] == \"${{ values.name }}\" { { % if values . logFormat == \"json\" %} # JSON \ub85c\uadf8\ub294 \uc774\ubbf8 \ud30c\uc2f1\ub428 {% else %} grok { match => { \"message\" => \"%{NGINXACCESS}\" } } { % endif %} date { match => [ \"time_local\", \"dd/MMM/yyyy:HH:mm:ss Z\" ] } mutate { convert => { \"response_time\" => \"float\" } convert => { \"status\" => \"integer\" } convert => { \"body_bytes_sent\" => \"integer\" } } } } output { elasticsearch { hosts => [ \"elasticsearch:9200\" ] index => \"nginx-${{ values.name }}-%{+YYYY.MM.dd}\" } } \uc54c\ub9bc \uc124\uc815 \u00b6 Prometheus Alertmanager \u00b6 \uc54c\ub9bc \uaddc\uce59 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # nginx-alerts.yml groups : - name : nginx-${{ values.name }} rules : - alert : NginxDown expr : up{job=\"nginx-${{ values.name }}\"} == 0 for : 1m labels : severity : critical annotations : summary : \"NGINX service is down\" description : \"NGINX service ${{ values.name }} has been down for more than 1 minute\" - alert : NginxHighErrorRate expr : rate(nginx_http_requests_total{job=\"nginx-${{ values.name }}\",status=~\"5..\"}[5m]) > 0.1 for : 5m labels : severity : warning annotations : summary : \"High error rate detected\" description : \"Error rate is {{ $value }} errors per second\" - alert : NginxHighLatency expr : histogram_quantile(0.95, rate(nginx_http_request_duration_seconds_bucket{job=\"nginx-${{ values.name }}\"}[5m])) > 1 for : 5m labels : severity : warning annotations : summary : \"High latency detected\" description : \"95th percentile latency is {{ $value }} seconds\" - alert : NginxHighConnections expr : nginx_connections_active{job=\"nginx-${{ values.name }}\"} > 1000 for : 5m labels : severity : warning annotations : summary : \"High number of active connections\" description : \"Active connections: {{ $value }}\" Alertmanager \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # alertmanager.yml global : smtp_smarthost : 'localhost:587' smtp_from : 'alerts@company.com' route : group_by : [ 'alertname' ] group_wait : 10s group_interval : 10s repeat_interval : 1h receiver : 'web.hook' receivers : - name : 'web.hook' email_configs : - to : 'admin@company.com' subject : 'NGINX Alert: {{ .GroupLabels.alertname }}' body : | {{ range .Alerts }} Alert: {{ .Annotations.summary }} Description: {{ .Annotations.description }} {{ end }} slack_configs : - api_url : 'YOUR_SLACK_WEBHOOK_URL' channel : '#alerts' title : 'NGINX Alert' text : '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}' \ud5ec\uc2a4 \uccb4\ud06c \u00b6 NGINX \ud5ec\uc2a4 \uccb4\ud06c \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # health check location location /health { access_log off ; return 200 \"healthy\\n\" ; add_header Content-Type text/plain ; } # nginx status (for monitoring) location /nginx_status { stub_status on ; access_log off ; allow 127 .0.0.1 ; allow 10 .0.0.0/8 ; deny all ; } Kubernetes \ud5ec\uc2a4 \uccb4\ud06c \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # deployment.yaml\uc5d0 \ucd94\uac00 livenessProbe : httpGet : path : /health port : 80 initialDelaySeconds : 30 periodSeconds : 10 readinessProbe : httpGet : path : /health port : 80 initialDelaySeconds : 5 periodSeconds : 5 \uc678\ubd80 \ud5ec\uc2a4 \uccb4\ud06c \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #!/bin/bash # health-check.sh URL = \"{% if values.enableSSL and values.domain %}https:// ${ { values.domain } }{% else %}http://localhost: ${ { values.port } }{% endif %}/health\" TIMEOUT = 10 response = $( curl -s -o /dev/null -w \"%{http_code}\" --max-time $TIMEOUT $URL ) if [ $response -eq 200 ] ; then echo \"Service is healthy\" exit 0 else echo \"Service is unhealthy (HTTP $response )\" exit 1 fi \uc131\ub2a5 \ubaa8\ub2c8\ud130\ub9c1 \u00b6 \uc8fc\uc694 \uc131\ub2a5 \uc9c0\ud45c \u00b6 \ucc98\ub9ac\ub7c9 (Throughput) \ucd08\ub2f9 \uc694\uccad \uc218 (RPS) \ucd08\ub2f9 \uc804\uc1a1 \ubc14\uc774\ud2b8 \uc9c0\uc5f0 \uc2dc\uac04 (Latency) \ud3c9\uade0 \uc751\ub2f5 \uc2dc\uac04 95 th /99 th \ubc31\ubd84\uc704\uc218 \uc5d0\ub7ec\uc728 (Error Rate) 4xx/5xx \uc751\ub2f5 \ube44\uc728 \ud0c0\uc784\uc544\uc6c3 \ube44\uc728 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 CPU \uc0ac\uc6a9\ub960 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960 \ub124\ud2b8\uc6cc\ud06c I/O \uc131\ub2a5 \ubca4\uce58\ub9c8\ud0b9 \u00b6 1 2 3 4 5 6 7 8 # Apache Bench \ud14c\uc2a4\ud2b8 ab -n 10000 -c 100 { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % } / # wrk \ud14c\uc2a4\ud2b8 wrk -t12 -c400 -d30s { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % } / # siege \ud14c\uc2a4\ud2b8 siege -c 100 -t 60s { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % } / \ud2b8\ub808\uc774\uc2f1 \u00b6 OpenTelemetry \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 # nginx.conf\uc5d0 \ucd94\uac00 load_module modules/ngx_http_opentelemetry_module.so ; http { opentelemetry_config /etc/nginx/otel-nginx.toml ; location / { opentelemetry on ; opentelemetry_operation_name $request_method$uri ; opentelemetry_propagate ; # \uae30\uc874 \uc124\uc815... } } Jaeger \uc5f0\ub3d9 \u00b6 1 2 3 4 5 6 7 8 # otel-nginx.toml [exporter] host = \"jaeger-collector\" port = 14268 [service] name = \"${{ values.name }}\" namespace = \"${{ values.namespace }}\" \ub300\uc2dc\ubcf4\ub4dc \uc608\uc2dc \u00b6 \uc8fc\uc694 \uba54\ud2b8\ub9ad \ub300\uc2dc\ubcf4\ub4dc \u00b6 \uc11c\ube44\uc2a4 \uac1c\uc694 \uc694\uccad \ucc98\ub9ac\uc728 \ud3c9\uade0 \uc751\ub2f5 \uc2dc\uac04 \uc5d0\ub7ec\uc728 \ud65c\uc131 \uc5f0\uacb0 \uc218 \uc131\ub2a5 \ubd84\uc11d \uc751\ub2f5 \uc2dc\uac04 \ubd84\ud3ec \ucc98\ub9ac\ub7c9 \ud2b8\ub80c\ub4dc \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 \uc5d0\ub7ec \ubd84\uc11d \uc5d0\ub7ec \ucf54\ub4dc \ubd84\ud3ec \uc5d0\ub7ec\uc728 \ud2b8\ub80c\ub4dc \uc2e4\ud328\ud55c \uc694\uccad \uc0c1\uc138 \uc778\ud504\ub77c \ubaa8\ub2c8\ud130\ub9c1 CPU/\uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960 \ub124\ud2b8\uc6cc\ud06c I/O \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub960 \ubb38\uc81c \ud574\uacb0 \u00b6 \ubaa8\ub2c8\ud130\ub9c1 \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 Troubleshooting \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.","title":"Monitoring"},{"location":"monitoring/#monitoring-observability","text":"\uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\uc758 \ubaa8\ub2c8\ud130\ub9c1 \ubc0f \uad00\ucc30 \uac00\ub2a5\uc131 \uc124\uc815\uc744 \uc124\uba85\ud569\ub2c8\ub2e4. {% if values.enableMonitoring %}","title":"Monitoring &amp; Observability"},{"location":"monitoring/#prometheus","text":"","title":"Prometheus \uba54\ud2b8\ub9ad"},{"location":"monitoring/#nginx-exporter","text":"NGINX Prometheus Exporter\uac00 \uc790\ub3d9\uc73c\ub85c \uc124\uc815\ub418\uc5b4 \ub2e4\uc74c \uba54\ud2b8\ub9ad\uc744 \uc218\uc9d1\ud569\ub2c8\ub2e4:","title":"NGINX Exporter \uc124\uc815"},{"location":"monitoring/#_1","text":"nginx_connections_active - \ud65c\uc131 \uc5f0\uacb0 \uc218 nginx_connections_reading - \uc77d\uae30 \uc911\uc778 \uc5f0\uacb0 \uc218 nginx_connections_writing - \uc4f0\uae30 \uc911\uc778 \uc5f0\uacb0 \uc218 nginx_connections_waiting - \ub300\uae30 \uc911\uc778 \uc5f0\uacb0 \uc218 nginx_http_requests_total - \ucd1d HTTP \uc694\uccad \uc218","title":"\uae30\ubcf8 \uba54\ud2b8\ub9ad"},{"location":"monitoring/#_2","text":"nginx_http_request_duration_seconds - \uc694\uccad \ucc98\ub9ac \uc2dc\uac04 nginx_http_request_size_bytes - \uc694\uccad \ud06c\uae30 nginx_http_response_size_bytes - \uc751\ub2f5 \ud06c\uae30","title":"\uc131\ub2a5 \uba54\ud2b8\ub9ad"},{"location":"monitoring/#_3","text":"1 2 3 4 5 # \uba54\ud2b8\ub9ad \ud655\uc778 curl http://localhost:9114/metrics # \ud2b9\uc815 \uba54\ud2b8\ub9ad \ud544\ud130\ub9c1 curl http://localhost:9114/metrics | grep nginx_connections","title":"\uba54\ud2b8\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8"},{"location":"monitoring/#prometheus_1","text":"prometheus.yml \uc124\uc815 \uc608\uc2dc: 1 2 3 4 5 6 7 8 9 10 global : scrape_interval : 15s scrape_configs : - job_name : 'nginx-${{ values.name }}' static_configs : - targets : [ 'localhost:9114' ] scrape_interval : 5s metrics_path : /metrics scheme : http","title":"Prometheus \uc124\uc815"},{"location":"monitoring/#grafana","text":"","title":"Grafana \ub300\uc2dc\ubcf4\ub4dc"},{"location":"monitoring/#_4","text":"Grafana\uc5d0 Prometheus \ub370\uc774\ud130\uc18c\uc2a4 \ucd94\uac00 NGINX \ub300\uc2dc\ubcf4\ub4dc \uc784\ud3ec\ud2b8 (ID: 12708) \ucee4\uc2a4\ud140 \ub300\uc2dc\ubcf4\ub4dc \uc0dd\uc131","title":"\ub300\uc2dc\ubcf4\ub4dc \uc124\uc815"},{"location":"monitoring/#_5","text":"","title":"\uc8fc\uc694 \ud328\ub110"},{"location":"monitoring/#_6","text":"1 2 3 4 5 6 7 8 9 10 11 12 { \"targets\" : [ { \"expr\" : \"nginx_connections_active{job=\\\"nginx-${{ values.name }}\\\"}\" , \"legendFormat\" : \"Active Connections\" }, { \"expr\" : \"nginx_connections_waiting{job=\\\"nginx-${{ values.name }}\\\"}\" , \"legendFormat\" : \"Waiting Connections\" } ] }","title":"\uc5f0\uacb0 \uc0c1\ud0dc \ud328\ub110"},{"location":"monitoring/#_7","text":"1 2 3 4 5 6 7 8 { \"targets\" : [ { \"expr\" : \"rate(nginx_http_requests_total{job=\\\"nginx-${{ values.name }}\\\"}[5m])\" , \"legendFormat\" : \"Requests/sec\" } ] }","title":"\uc694\uccad \ucc98\ub9ac\uc728 \ud328\ub110"},{"location":"monitoring/#_8","text":"1 2 3 4 5 6 7 8 9 10 11 12 { \"targets\" : [ { \"expr\" : \"histogram_quantile(0.95, rate(nginx_http_request_duration_seconds_bucket{job=\\\"nginx-${{ values.name }}\\\"}[5m]))\" , \"legendFormat\" : \"95th percentile\" }, { \"expr\" : \"histogram_quantile(0.50, rate(nginx_http_request_duration_seconds_bucket{job=\\\"nginx-${{ values.name }}\\\"}[5m]))\" , \"legendFormat\" : \"50th percentile\" } ] }","title":"\uc751\ub2f5 \uc2dc\uac04 \ud328\ub110"},{"location":"monitoring/#_9","text":"{% if values.enableAccessLogs %}","title":"\ub85c\uadf8 \ubaa8\ub2c8\ud130\ub9c1"},{"location":"monitoring/#_10","text":"{% if values.logFormat == \"json\" %} JSON \ud615\uc2dd \ub85c\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad6c\uc870\ud654\ub41c \ubd84\uc11d\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4: 1 2 3 4 5 6 7 8 # \uc0c1\uc704 IP \uc8fc\uc18c \ubd84\uc11d cat /var/log/nginx/access.log | jq -r '.remote_addr' | sort | uniq -c | sort -nr | head -10 # \uc751\ub2f5 \uc2dc\uac04 \ubd84\uc11d cat /var/log/nginx/access.log | jq -r '.request_time' | awk '{sum+=$1; count++} END {print \"Average:\", sum/count}' # \uc0c1\ud0dc \ucf54\ub4dc \ubd84\ud3ec cat /var/log/nginx/access.log | jq -r '.status' | sort | uniq -c | sort -nr {% else %} \ud45c\uc900 \ub85c\uadf8 \ud615\uc2dd \ubd84\uc11d: 1 2 3 4 5 6 7 8 # \uc0c1\uc704 IP \uc8fc\uc18c awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 # \uc0c1\ud0dc \ucf54\ub4dc \ubd84\ud3ec awk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -nr # \uc694\uccad URL \ubd84\uc11d awk '{print $7}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10","title":"\uc811\uadfc \ub85c\uadf8 \ubd84\uc11d"},{"location":"monitoring/#elk-stack","text":"","title":"ELK Stack \uc5f0\ub3d9"},{"location":"monitoring/#filebeat","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # filebeat.yml filebeat.inputs : - type : log enabled : true paths : - /var/log/nginx/access.log { % if values.logFormat == \"json\" % } json.keys_under_root : true json.add_error_key : true { % endif % } fields : service : ${{ values.name }} environment : production output.elasticsearch : hosts : [ \"elasticsearch:9200\" ] index : \"nginx-${{ values.name }}-%{+yyyy.MM.dd}\" setup.template.name : \"nginx-${{ values.name }}\" setup.template.pattern : \"nginx-${{ values.name }}-*\"","title":"Filebeat \uc124\uc815"},{"location":"monitoring/#logstash","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # logstash.conf input { beats { port => 5044 } } filter { if [ service ] == \"${{ values.name }}\" { { % if values . logFormat == \"json\" %} # JSON \ub85c\uadf8\ub294 \uc774\ubbf8 \ud30c\uc2f1\ub428 {% else %} grok { match => { \"message\" => \"%{NGINXACCESS}\" } } { % endif %} date { match => [ \"time_local\", \"dd/MMM/yyyy:HH:mm:ss Z\" ] } mutate { convert => { \"response_time\" => \"float\" } convert => { \"status\" => \"integer\" } convert => { \"body_bytes_sent\" => \"integer\" } } } } output { elasticsearch { hosts => [ \"elasticsearch:9200\" ] index => \"nginx-${{ values.name }}-%{+YYYY.MM.dd}\" } }","title":"Logstash \uc124\uc815"},{"location":"monitoring/#_11","text":"","title":"\uc54c\ub9bc \uc124\uc815"},{"location":"monitoring/#prometheus-alertmanager","text":"","title":"Prometheus Alertmanager"},{"location":"monitoring/#_12","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # nginx-alerts.yml groups : - name : nginx-${{ values.name }} rules : - alert : NginxDown expr : up{job=\"nginx-${{ values.name }}\"} == 0 for : 1m labels : severity : critical annotations : summary : \"NGINX service is down\" description : \"NGINX service ${{ values.name }} has been down for more than 1 minute\" - alert : NginxHighErrorRate expr : rate(nginx_http_requests_total{job=\"nginx-${{ values.name }}\",status=~\"5..\"}[5m]) > 0.1 for : 5m labels : severity : warning annotations : summary : \"High error rate detected\" description : \"Error rate is {{ $value }} errors per second\" - alert : NginxHighLatency expr : histogram_quantile(0.95, rate(nginx_http_request_duration_seconds_bucket{job=\"nginx-${{ values.name }}\"}[5m])) > 1 for : 5m labels : severity : warning annotations : summary : \"High latency detected\" description : \"95th percentile latency is {{ $value }} seconds\" - alert : NginxHighConnections expr : nginx_connections_active{job=\"nginx-${{ values.name }}\"} > 1000 for : 5m labels : severity : warning annotations : summary : \"High number of active connections\" description : \"Active connections: {{ $value }}\"","title":"\uc54c\ub9bc \uaddc\uce59"},{"location":"monitoring/#alertmanager","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # alertmanager.yml global : smtp_smarthost : 'localhost:587' smtp_from : 'alerts@company.com' route : group_by : [ 'alertname' ] group_wait : 10s group_interval : 10s repeat_interval : 1h receiver : 'web.hook' receivers : - name : 'web.hook' email_configs : - to : 'admin@company.com' subject : 'NGINX Alert: {{ .GroupLabels.alertname }}' body : | {{ range .Alerts }} Alert: {{ .Annotations.summary }} Description: {{ .Annotations.description }} {{ end }} slack_configs : - api_url : 'YOUR_SLACK_WEBHOOK_URL' channel : '#alerts' title : 'NGINX Alert' text : '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'","title":"Alertmanager \uc124\uc815"},{"location":"monitoring/#_13","text":"","title":"\ud5ec\uc2a4 \uccb4\ud06c"},{"location":"monitoring/#nginx","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # health check location location /health { access_log off ; return 200 \"healthy\\n\" ; add_header Content-Type text/plain ; } # nginx status (for monitoring) location /nginx_status { stub_status on ; access_log off ; allow 127 .0.0.1 ; allow 10 .0.0.0/8 ; deny all ; }","title":"NGINX \ud5ec\uc2a4 \uccb4\ud06c \uc5d4\ub4dc\ud3ec\uc778\ud2b8"},{"location":"monitoring/#kubernetes","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 # deployment.yaml\uc5d0 \ucd94\uac00 livenessProbe : httpGet : path : /health port : 80 initialDelaySeconds : 30 periodSeconds : 10 readinessProbe : httpGet : path : /health port : 80 initialDelaySeconds : 5 periodSeconds : 5","title":"Kubernetes \ud5ec\uc2a4 \uccb4\ud06c"},{"location":"monitoring/#_14","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #!/bin/bash # health-check.sh URL = \"{% if values.enableSSL and values.domain %}https:// ${ { values.domain } }{% else %}http://localhost: ${ { values.port } }{% endif %}/health\" TIMEOUT = 10 response = $( curl -s -o /dev/null -w \"%{http_code}\" --max-time $TIMEOUT $URL ) if [ $response -eq 200 ] ; then echo \"Service is healthy\" exit 0 else echo \"Service is unhealthy (HTTP $response )\" exit 1 fi","title":"\uc678\ubd80 \ud5ec\uc2a4 \uccb4\ud06c"},{"location":"monitoring/#_15","text":"","title":"\uc131\ub2a5 \ubaa8\ub2c8\ud130\ub9c1"},{"location":"monitoring/#_16","text":"\ucc98\ub9ac\ub7c9 (Throughput) \ucd08\ub2f9 \uc694\uccad \uc218 (RPS) \ucd08\ub2f9 \uc804\uc1a1 \ubc14\uc774\ud2b8 \uc9c0\uc5f0 \uc2dc\uac04 (Latency) \ud3c9\uade0 \uc751\ub2f5 \uc2dc\uac04 95 th /99 th \ubc31\ubd84\uc704\uc218 \uc5d0\ub7ec\uc728 (Error Rate) 4xx/5xx \uc751\ub2f5 \ube44\uc728 \ud0c0\uc784\uc544\uc6c3 \ube44\uc728 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 CPU \uc0ac\uc6a9\ub960 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960 \ub124\ud2b8\uc6cc\ud06c I/O","title":"\uc8fc\uc694 \uc131\ub2a5 \uc9c0\ud45c"},{"location":"monitoring/#_17","text":"1 2 3 4 5 6 7 8 # Apache Bench \ud14c\uc2a4\ud2b8 ab -n 10000 -c 100 { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % } / # wrk \ud14c\uc2a4\ud2b8 wrk -t12 -c400 -d30s { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % } / # siege \ud14c\uc2a4\ud2b8 siege -c 100 -t 60s { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % } /","title":"\uc131\ub2a5 \ubca4\uce58\ub9c8\ud0b9"},{"location":"monitoring/#_18","text":"","title":"\ud2b8\ub808\uc774\uc2f1"},{"location":"monitoring/#opentelemetry","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 # nginx.conf\uc5d0 \ucd94\uac00 load_module modules/ngx_http_opentelemetry_module.so ; http { opentelemetry_config /etc/nginx/otel-nginx.toml ; location / { opentelemetry on ; opentelemetry_operation_name $request_method$uri ; opentelemetry_propagate ; # \uae30\uc874 \uc124\uc815... } }","title":"OpenTelemetry \uc124\uc815"},{"location":"monitoring/#jaeger","text":"1 2 3 4 5 6 7 8 # otel-nginx.toml [exporter] host = \"jaeger-collector\" port = 14268 [service] name = \"${{ values.name }}\" namespace = \"${{ values.namespace }}\"","title":"Jaeger \uc5f0\ub3d9"},{"location":"monitoring/#_19","text":"","title":"\ub300\uc2dc\ubcf4\ub4dc \uc608\uc2dc"},{"location":"monitoring/#_20","text":"\uc11c\ube44\uc2a4 \uac1c\uc694 \uc694\uccad \ucc98\ub9ac\uc728 \ud3c9\uade0 \uc751\ub2f5 \uc2dc\uac04 \uc5d0\ub7ec\uc728 \ud65c\uc131 \uc5f0\uacb0 \uc218 \uc131\ub2a5 \ubd84\uc11d \uc751\ub2f5 \uc2dc\uac04 \ubd84\ud3ec \ucc98\ub9ac\ub7c9 \ud2b8\ub80c\ub4dc \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 \uc5d0\ub7ec \ubd84\uc11d \uc5d0\ub7ec \ucf54\ub4dc \ubd84\ud3ec \uc5d0\ub7ec\uc728 \ud2b8\ub80c\ub4dc \uc2e4\ud328\ud55c \uc694\uccad \uc0c1\uc138 \uc778\ud504\ub77c \ubaa8\ub2c8\ud130\ub9c1 CPU/\uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960 \ub124\ud2b8\uc6cc\ud06c I/O \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub960","title":"\uc8fc\uc694 \uba54\ud2b8\ub9ad \ub300\uc2dc\ubcf4\ub4dc"},{"location":"monitoring/#_21","text":"\ubaa8\ub2c8\ud130\ub9c1 \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 Troubleshooting \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.","title":"\ubb38\uc81c \ud574\uacb0"},{"location":"security/","text":"Security Guide \u00b6 \uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\uc758 \ubcf4\uc548 \uc124\uc815 \ubc0f \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc124\uba85\ud569\ub2c8\ub2e4. SSL/TLS \uc124\uc815 \u00b6 {% if values.enableSSL %} \uc778\uc99d\uc11c \uad00\ub9ac \u00b6 ${{ values.sslProvider }} \uc124\uc815 \u00b6 {% if values.sslProvider == \"cert-manager\" %} Cert-Manager\ub97c \uc0ac\uc6a9\ud55c \uc790\ub3d9 \uc778\uc99d\uc11c \uad00\ub9ac: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # certificate.yaml apiVersion : cert-manager.io/v1 kind : Certificate metadata : name : ${{ values.name }}-tls namespace : ${{ values.namespace }} spec : secretName : ${{ values.name }}-tls issuerRef : name : letsencrypt-prod kind : ClusterIssuer dnsNames : - ${{ values.domain }} { % if values.additionalDomains % } { % for domain in values.additionalDomains % } - {{ domain }} { % endfor % } { % endif % } ClusterIssuer \uc124\uc815: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # cluster-issuer.yaml apiVersion : cert-manager.io/v1 kind : ClusterIssuer metadata : name : letsencrypt-prod spec : acme : server : https://acme-v02.api.letsencrypt.org/directory email : admin@company.com privateKeySecretRef : name : letsencrypt-prod solvers : - http01 : ingress : class : ${{ values.ingressClass }} {% elif values.sslProvider == \"manual\" %} \uc218\ub3d9 \uc778\uc99d\uc11c \uad00\ub9ac: 1 2 3 4 5 6 7 8 # \uc778\uc99d\uc11c \uc0dd\uc131 (Let's Encrypt) certbot certonly --webroot -w /usr/share/nginx/html -d ${ { values.domain } }{ % if values.additionalDomains % } { % for domain in values.additionalDomains % } -d {{ domain }} { % endfor % }{ % endif % } # Kubernetes Secret \uc0dd\uc131 kubectl create secret tls ${ { values.name } } -tls \\ --cert = /etc/letsencrypt/live/ ${ { values.domain } } /fullchain.pem \\ --key = /etc/letsencrypt/live/ ${ { values.domain } } /privkey.pem \\ -n ${ { values.namespace } } {% elif values.sslProvider == \"self-signed\" %} \uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c (\uac1c\ubc1c\uc6a9): 1 2 3 4 5 6 7 8 # \uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c \uc0dd\uc131 openssl req -x509 -nodes -days 365 -newkey rsa:2048 \\ -keyout tls.key -out tls.crt \\ -subj \"/CN= ${ { values.domain } }/O= ${ { values.name } }\" # Kubernetes Secret \uc0dd\uc131 kubectl create secret tls ${ { values.name } } -tls \\ --cert = tls.crt --key = tls.key -n ${ { values.namespace } } NGINX SSL \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 server { listen 443 ssl http2 ; server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; # SSL \uc778\uc99d\uc11c ssl_certificate /etc/nginx/ssl/tls.crt ; ssl_certificate_key /etc/nginx/ssl/tls.key ; # SSL \ud504\ub85c\ud1a0\ucf5c \ubc0f \uc554\ud638\ud654 ssl_protocols TLSv1.2 TLSv1.3 ; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384 ; ssl_prefer_server_ciphers off ; # SSL \uc138\uc158 \uc124\uc815 ssl_session_cache shared:SSL:10m ; ssl_session_timeout 10m ; # OCSP Stapling ssl_stapling on ; ssl_stapling_verify on ; ssl_trusted_certificate /etc/nginx/ssl/chain.pem ; # \ubcf4\uc548 \ud5e4\ub354 add_header Strict-Transport-Security \"max-age=31536000 ; includeSubDomains\" always ; add_header X-Frame-Options \"SAMEORIGIN\" always ; add_header X-Content-Type-Options \"nosniff\" always ; add_header X-XSS-Protection \"1 ; mode=block\" always ; add_header Referrer-Policy \"strict-origin-when-cross-origin\" always ; # \ub098\uba38\uc9c0 \uc124\uc815... } # HTTP to HTTPS \ub9ac\ub2e4\uc774\ub809\ud2b8 server { listen 80 ; server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; return 301 https:// $server_name$request_uri ; } \uc811\uadfc \uc81c\uc5b4 \u00b6 {% if values.enableBasicAuth %} HTTP Basic Authentication \u00b6 1 2 3 4 5 6 7 8 9 # .htpasswd \ud30c\uc77c \uc0dd\uc131 htpasswd -c /etc/nginx/.htpasswd admin # NGINX \uc124\uc815 location / { auth_basic \"Restricted Area\" ; auth_basic_user_file /etc/nginx/.htpasswd ; # \ub098\uba38\uc9c0 \uc124\uc815... } Kubernetes Secret\uc73c\ub85c \uad00\ub9ac: 1 2 3 4 # htpasswd \ud30c\uc77c\uc744 Secret\uc73c\ub85c \uc0dd\uc131 kubectl create secret generic ${ { values.name } } -auth \\ --from-file = .htpasswd = /path/to/.htpasswd \\ -n ${ { values.namespace } } {% if values.allowedIPs %} IP \uae30\ubc18 \uc811\uadfc \uc81c\uc5b4 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # \ud5c8\uc6a9\ub41c IP\ub9cc \uc811\uadfc \uac00\ub2a5 location / { {% for ip in values.allowedIPs % } allow { { ip }} ; {% endfor % } deny all ; # \ub098\uba38\uc9c0 \uc124\uc815... } # \uad00\ub9ac\uc790 \uc601\uc5ed \ubcf4\ud638 location /admin { allow 192 .168.1.0/24 ; # \ub0b4\ubd80 \ub124\ud2b8\uc6cc\ud06c\ub9cc deny all ; # \ub098\uba38\uc9c0 \uc124\uc815... } OAuth2/OIDC \uc778\uc99d \u00b6 OAuth2 Proxy\ub97c \uc0ac\uc6a9\ud55c \uc778\uc99d: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # oauth2-proxy.yaml apiVersion : apps/v1 kind : Deployment metadata : name : oauth2-proxy spec : replicas : 1 selector : matchLabels : app : oauth2-proxy template : metadata : labels : app : oauth2-proxy spec : containers : - name : oauth2-proxy image : quay.io/oauth2-proxy/oauth2-proxy:latest args : - --provider=oidc - --email-domain=* - --upstream=http://${{ values.name }}:80 - --http-address=0.0.0.0:4180 - --oidc-issuer-url=https://your-oidc-provider.com env : - name : OAUTH2_PROXY_CLIENT_ID valueFrom : secretKeyRef : name : oauth2-proxy-secret key : client-id - name : OAUTH2_PROXY_CLIENT_SECRET valueFrom : secretKeyRef : name : oauth2-proxy-secret key : client-secret - name : OAUTH2_PROXY_COOKIE_SECRET valueFrom : secretKeyRef : name : oauth2-proxy-secret key : cookie-secret \ubcf4\uc548 \ud5e4\ub354 \u00b6 \ud544\uc218 \ubcf4\uc548 \ud5e4\ub354 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # \ubcf4\uc548 \ud5e4\ub354 \uc124\uc815 add_header X-Frame-Options \"SAMEORIGIN\" always ; add_header X-XSS-Protection \"1 ; mode=block\" always ; add_header X-Content-Type-Options \"nosniff\" always ; add_header Referrer-Policy \"strict-origin-when-cross-origin\" always ; add_header Content-Security-Policy \"default-src 'self' ; script-src 'self' 'unsafe-inline' ; style-src 'self' 'unsafe-inline' ; img-src 'self' data: https: ; \" always ; {% if values.enableSSL % } # HSTS (HTTPS \uc804\uc6a9) add_header Strict-Transport-Security \"max-age=31536000 ; includeSubDomains ; preload\" always ; {% endif % } # \uc11c\ubc84 \uc815\ubcf4 \uc228\uae30\uae30 server_tokens off ; more_clear_headers Server ; CSP (Content Security Policy) \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 # \uc5c4\uaca9\ud55c CSP \uc815\ucc45 add_header Content-Security-Policy \" default-src 'self' ; script-src 'self' 'unsafe-inline' https://trusted-cdn.com ; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com ; font-src 'self' https://fonts.gstatic.com ; img-src 'self' data: https: ; connect-src 'self' https://api.example.com ; frame-ancestors 'none' ; base-uri 'self' ; form-action 'self' ; \" always ; \uc18d\ub3c4 \uc81c\ud55c \ubc0f DDoS \ubc29\uc5b4 \u00b6 {% if values.enableRateLimit %} \uae30\ubcf8 \uc18d\ub3c4 \uc81c\ud55c \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # IP\ubcc4 \uc18d\ub3c4 \uc81c\ud55c limit_req_zone $binary_remote_addr zone=api:10m rate= ${{ values.rateLimitRpm }} r/m ; limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m ; # \uc5f0\uacb0 \uc218 \uc81c\ud55c limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m ; server { # \uc77c\ubc18 \uc694\uccad \uc81c\ud55c limit_req zone=api burst=20 nodelay ; # \uc5f0\uacb0 \uc218 \uc81c\ud55c limit_conn conn_limit_per_ip 10 ; # \ub85c\uadf8\uc778 \ud398\uc774\uc9c0 \ubcf4\ud638 location /login { limit_req zone=login burst=5 nodelay ; # \ub098\uba38\uc9c0 \uc124\uc815... } } \uace0\uae09 DDoS \ubc29\uc5b4 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # \ub300\uc6a9\ub7c9 \uc694\uccad \ucc28\ub2e8 client_max_body_size 10m ; client_body_buffer_size 128k ; client_header_buffer_size 1k ; large_client_header_buffers 4 4k ; # \ub290\ub9b0 \uacf5\uaca9 \ubc29\uc5b4 client_body_timeout 12 ; client_header_timeout 12 ; keepalive_timeout 15 ; send_timeout 10 ; # \uc758\uc2ec\uc2a4\ub7ec\uc6b4 User-Agent \ucc28\ub2e8 map $http_user_agent $blocked_agent { ~*malicious 1 ; ~*bot 1 ; ~*crawler 1 ; default 0 ; } server { if ( $blocked_agent ) { return 403 ; } } \ub85c\uadf8 \ubcf4\uc548 \u00b6 \ubbfc\uac10 \uc815\ubcf4 \ub9c8\uc2a4\ud0b9 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # \ubbfc\uac10\ud55c \ud30c\ub77c\ubbf8\ud130 \ub85c\uae45 \uc81c\uc678 map $request_uri $loggable { ~*password 0 ; ~*token 0 ; ~*secret 0 ; default 1 ; } # \uc870\uac74\ubd80 \ub85c\uae45 access_log /var/log/nginx/access.log combined if= $loggable ; # \ubbfc\uac10 \uc815\ubcf4 \ub9c8\uc2a4\ud0b9 \ub85c\uadf8 \ud615\uc2dd log_format secure ' $remote_addr - $remote_user [ $time_local] ' '\" $request_method $uri $server_protocol\" ' ' $status $body_bytes_sent ' '\" $http_referer\" \" $http_user_agent\"' ; \ub85c\uadf8 \ud30c\uc77c \ubcf4\uc548 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # \ub85c\uadf8 \ud30c\uc77c \uad8c\ud55c \uc124\uc815 chmod 640 /var/log/nginx/*.log chown nginx:adm /var/log/nginx/*.log # \ub85c\uadf8 \ub85c\ud14c\uc774\uc158 \ubcf4\uc548 \uc124\uc815 # /etc/logrotate.d/nginx /var/log/nginx/*.log { daily missingok rotate 52 compress delaycompress notifempty create 640 nginx adm sharedscripts postrotate if [ -f /var/run/nginx.pid ] ; then kill -USR1 ` cat /var/run/nginx.pid ` fi endscript } \ucee8\ud14c\uc774\ub108 \ubcf4\uc548 \u00b6 Docker \ubcf4\uc548 \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # Dockerfile \ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840 FROM nginx:${{ values.nginxVersion }} # \ube44\ud2b9\uad8c \uc0ac\uc6a9\uc790\ub85c \uc2e4\ud589 RUN groupadd -r nginx && useradd -r -g nginx nginx # \ubd88\ud544\uc694\ud55c \ud328\ud0a4\uc9c0 \uc81c\uac70 RUN apt-get update && apt-get install -y --no-install-recommends \\ ca-certificates \\ && rm -rf /var/lib/apt/lists/* # \ud30c\uc77c \uad8c\ud55c \uc124\uc815 COPY --chown = nginx:nginx config/ /etc/nginx/ COPY --chown = nginx:nginx html/ /usr/share/nginx/html/ # \ubcf4\uc548 \uc124\uc815 RUN chmod -R 644 /etc/nginx/ && \\ chmod -R 644 /usr/share/nginx/html/ && \\ chmod 755 /etc/nginx/conf.d/ USER nginx EXPOSE 8080 CMD [ \"nginx\" , \"-g\" , \"daemon off;\" ] Kubernetes \ubcf4\uc548 \uc124\uc815 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # security-context.yaml apiVersion : apps/v1 kind : Deployment metadata : name : ${{ values.name }} spec : template : spec : securityContext : runAsNonRoot : true runAsUser : 101 runAsGroup : 101 fsGroup : 101 containers : - name : nginx image : nginx:${{ values.nginxVersion }} securityContext : allowPrivilegeEscalation : false readOnlyRootFilesystem : true capabilities : drop : - ALL add : - NET_BIND_SERVICE resources : limits : memory : \"128Mi\" cpu : \"500m\" requests : memory : \"64Mi\" cpu : \"250m\" Pod Security Standards \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # pod-security-policy.yaml apiVersion : policy/v1beta1 kind : PodSecurityPolicy metadata : name : ${{ values.name }}-psp spec : privileged : false allowPrivilegeEscalation : false requiredDropCapabilities : - ALL volumes : - 'configMap' - 'emptyDir' - 'projected' - 'secret' - 'downwardAPI' - 'persistentVolumeClaim' runAsUser : rule : 'MustRunAsNonRoot' seLinux : rule : 'RunAsAny' fsGroup : rule : 'RunAsAny' \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548 \u00b6 Network Policies \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # network-policy.yaml apiVersion : networking.k8s.io/v1 kind : NetworkPolicy metadata : name : ${{ values.name }}-netpol namespace : ${{ values.namespace }} spec : podSelector : matchLabels : app : ${{ values.name }} policyTypes : - Ingress - Egress ingress : - from : - namespaceSelector : matchLabels : name : ingress-nginx ports : - protocol : TCP port : 80 egress : - to : [] ports : - protocol : TCP port : 53 - protocol : UDP port : 53 Service Mesh \ubcf4\uc548 (Istio) \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # istio-security.yaml apiVersion : security.istio.io/v1beta1 kind : PeerAuthentication metadata : name : ${{ values.name }}-peer-auth namespace : ${{ values.namespace }} spec : selector : matchLabels : app : ${{ values.name }} mtls : mode : STRICT --- apiVersion : security.istio.io/v1beta1 kind : AuthorizationPolicy metadata : name : ${{ values.name }}-authz namespace : ${{ values.namespace }} spec : selector : matchLabels : app : ${{ values.name }} rules : - from : - source : principals : [ \"cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account\" ] \ubcf4\uc548 \uc2a4\uce90\ub2dd \u00b6 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \uc2a4\uce94 \u00b6 1 2 3 4 5 # Trivy\ub97c \uc0ac\uc6a9\ud55c \ucde8\uc57d\uc810 \uc2a4\uce94 trivy image nginx: ${ { values.nginxVersion } } # Clair\ub97c \uc0ac\uc6a9\ud55c \uc2a4\uce94 clairctl analyze nginx: ${ { values.nginxVersion } } \uc124\uc815 \ubcf4\uc548 \uac80\uc0ac \u00b6 1 2 3 4 5 6 7 8 # NGINX \uc124\uc815 \ubcf4\uc548 \uac80\uc0ac nginx -t -c /etc/nginx/nginx.conf # SSL \uc124\uc815 \ud14c\uc2a4\ud2b8 testssl.sh { % if values.domain % } ${ { values.domain } }{ % else % } localhost { % endif % } # \ubcf4\uc548 \ud5e4\ub354 \uac80\uc0ac curl -I { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % } \ubcf4\uc548 \ubaa8\ub2c8\ud130\ub9c1 \u00b6 \ubcf4\uc548 \uc774\ubca4\ud2b8 \ub85c\uae45 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # \ubcf4\uc548 \uc774\ubca4\ud2b8 \ub85c\uadf8 \ud615\uc2dd log_format security ' $remote_addr - $remote_user [ $time_local] ' '\" $request\" $status $body_bytes_sent ' '\" $http_referer\" \" $http_user_agent\" ' 'rt= $request_time ua=\" $upstream_addr\" ' 'us=\" $upstream_status\" ut=\" $upstream_response_time\"' ; # \ubcf4\uc548 \uc774\ubca4\ud2b8\ub9cc \ubcc4\ub3c4 \ub85c\uae45 map $status $security_log { ~^4 1 ; # 4xx \uc5d0\ub7ec ~^5 1 ; # 5xx \uc5d0\ub7ec default 0 ; } access_log /var/log/nginx/security.log security if= $security_log ; \uce68\uc785 \ud0d0\uc9c0 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Fail2ban \uc124\uc815 # /etc/fail2ban/jail.local [ nginx-http-auth ] enabled = true filter = nginx-http-auth logpath = /var/log/nginx/error.log maxretry = 5 bantime = 3600 [ nginx-noscript ] enabled = true filter = nginx-noscript logpath = /var/log/nginx/access.log maxretry = 6 bantime = 86400 \ubcf4\uc548 \uccb4\ud06c\ub9ac\uc2a4\ud2b8 \u00b6 \ubc30\ud3ec \uc804 \uccb4\ud06c\ub9ac\uc2a4\ud2b8 \u00b6 SSL/TLS \uc778\uc99d\uc11c \uc124\uc815 \ubc0f \uac80\uc99d \ubcf4\uc548 \ud5e4\ub354 \uc124\uc815 \ud655\uc778 \uc811\uadfc \uc81c\uc5b4 \uc815\ucc45 \uac80\ud1a0 \uc18d\ub3c4 \uc81c\ud55c \uc124\uc815 \ud655\uc778 \ub85c\uadf8 \uc124\uc815 \ubc0f \ubbfc\uac10 \uc815\ubcf4 \ub9c8\uc2a4\ud0b9 \ucee8\ud14c\uc774\ub108 \ubcf4\uc548 \uc124\uc815 \uac80\ud1a0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc124\uc815 \ucde8\uc57d\uc810 \uc2a4\uce94 \uc2e4\ud589 \ubcf4\uc548 \ud14c\uc2a4\ud2b8 \uc218\ud589 \uc815\uae30 \ubcf4\uc548 \uc810\uac80 \u00b6 \uc778\uc99d\uc11c \ub9cc\ub8cc\uc77c \ud655\uc778 \ubcf4\uc548 \ud328\uce58 \uc801\uc6a9 \ub85c\uadf8 \ubd84\uc11d \ubc0f \uc774\uc0c1 \uc9d5\ud6c4 \ud655\uc778 \uc811\uadfc \uad8c\ud55c \uac80\ud1a0 \ubc31\uc5c5 \ubc0f \ubcf5\uad6c \ud14c\uc2a4\ud2b8 \ubcf4\uc548 \uc815\ucc45 \uc5c5\ub370\uc774\ud2b8 \ubb38\uc81c \ud574\uacb0 \u00b6 \ubcf4\uc548 \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 Troubleshooting \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.","title":"Security"},{"location":"security/#security-guide","text":"\uc774 \uac00\uc774\ub4dc\ub294 ${{ values.name }} \uc11c\ube44\uc2a4\uc758 \ubcf4\uc548 \uc124\uc815 \ubc0f \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc124\uba85\ud569\ub2c8\ub2e4.","title":"Security Guide"},{"location":"security/#ssltls","text":"{% if values.enableSSL %}","title":"SSL/TLS \uc124\uc815"},{"location":"security/#_1","text":"","title":"\uc778\uc99d\uc11c \uad00\ub9ac"},{"location":"security/#valuessslprovider","text":"{% if values.sslProvider == \"cert-manager\" %} Cert-Manager\ub97c \uc0ac\uc6a9\ud55c \uc790\ub3d9 \uc778\uc99d\uc11c \uad00\ub9ac: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # certificate.yaml apiVersion : cert-manager.io/v1 kind : Certificate metadata : name : ${{ values.name }}-tls namespace : ${{ values.namespace }} spec : secretName : ${{ values.name }}-tls issuerRef : name : letsencrypt-prod kind : ClusterIssuer dnsNames : - ${{ values.domain }} { % if values.additionalDomains % } { % for domain in values.additionalDomains % } - {{ domain }} { % endfor % } { % endif % } ClusterIssuer \uc124\uc815: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # cluster-issuer.yaml apiVersion : cert-manager.io/v1 kind : ClusterIssuer metadata : name : letsencrypt-prod spec : acme : server : https://acme-v02.api.letsencrypt.org/directory email : admin@company.com privateKeySecretRef : name : letsencrypt-prod solvers : - http01 : ingress : class : ${{ values.ingressClass }} {% elif values.sslProvider == \"manual\" %} \uc218\ub3d9 \uc778\uc99d\uc11c \uad00\ub9ac: 1 2 3 4 5 6 7 8 # \uc778\uc99d\uc11c \uc0dd\uc131 (Let's Encrypt) certbot certonly --webroot -w /usr/share/nginx/html -d ${ { values.domain } }{ % if values.additionalDomains % } { % for domain in values.additionalDomains % } -d {{ domain }} { % endfor % }{ % endif % } # Kubernetes Secret \uc0dd\uc131 kubectl create secret tls ${ { values.name } } -tls \\ --cert = /etc/letsencrypt/live/ ${ { values.domain } } /fullchain.pem \\ --key = /etc/letsencrypt/live/ ${ { values.domain } } /privkey.pem \\ -n ${ { values.namespace } } {% elif values.sslProvider == \"self-signed\" %} \uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c (\uac1c\ubc1c\uc6a9): 1 2 3 4 5 6 7 8 # \uc790\uccb4 \uc11c\uba85 \uc778\uc99d\uc11c \uc0dd\uc131 openssl req -x509 -nodes -days 365 -newkey rsa:2048 \\ -keyout tls.key -out tls.crt \\ -subj \"/CN= ${ { values.domain } }/O= ${ { values.name } }\" # Kubernetes Secret \uc0dd\uc131 kubectl create secret tls ${ { values.name } } -tls \\ --cert = tls.crt --key = tls.key -n ${ { values.namespace } }","title":"${{ values.sslProvider }} \uc124\uc815"},{"location":"security/#nginx-ssl","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 server { listen 443 ssl http2 ; server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; # SSL \uc778\uc99d\uc11c ssl_certificate /etc/nginx/ssl/tls.crt ; ssl_certificate_key /etc/nginx/ssl/tls.key ; # SSL \ud504\ub85c\ud1a0\ucf5c \ubc0f \uc554\ud638\ud654 ssl_protocols TLSv1.2 TLSv1.3 ; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384 ; ssl_prefer_server_ciphers off ; # SSL \uc138\uc158 \uc124\uc815 ssl_session_cache shared:SSL:10m ; ssl_session_timeout 10m ; # OCSP Stapling ssl_stapling on ; ssl_stapling_verify on ; ssl_trusted_certificate /etc/nginx/ssl/chain.pem ; # \ubcf4\uc548 \ud5e4\ub354 add_header Strict-Transport-Security \"max-age=31536000 ; includeSubDomains\" always ; add_header X-Frame-Options \"SAMEORIGIN\" always ; add_header X-Content-Type-Options \"nosniff\" always ; add_header X-XSS-Protection \"1 ; mode=block\" always ; add_header Referrer-Policy \"strict-origin-when-cross-origin\" always ; # \ub098\uba38\uc9c0 \uc124\uc815... } # HTTP to HTTPS \ub9ac\ub2e4\uc774\ub809\ud2b8 server { listen 80 ; server_name ${{ values.domain }} { % if values.additionalDomains % } ${{ values.additionalDomains | join(' ') }} { % endif % } ; return 301 https:// $server_name$request_uri ; }","title":"NGINX SSL \uc124\uc815"},{"location":"security/#_2","text":"{% if values.enableBasicAuth %}","title":"\uc811\uadfc \uc81c\uc5b4"},{"location":"security/#http-basic-authentication","text":"1 2 3 4 5 6 7 8 9 # .htpasswd \ud30c\uc77c \uc0dd\uc131 htpasswd -c /etc/nginx/.htpasswd admin # NGINX \uc124\uc815 location / { auth_basic \"Restricted Area\" ; auth_basic_user_file /etc/nginx/.htpasswd ; # \ub098\uba38\uc9c0 \uc124\uc815... } Kubernetes Secret\uc73c\ub85c \uad00\ub9ac: 1 2 3 4 # htpasswd \ud30c\uc77c\uc744 Secret\uc73c\ub85c \uc0dd\uc131 kubectl create secret generic ${ { values.name } } -auth \\ --from-file = .htpasswd = /path/to/.htpasswd \\ -n ${ { values.namespace } } {% if values.allowedIPs %}","title":"HTTP Basic Authentication"},{"location":"security/#ip","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # \ud5c8\uc6a9\ub41c IP\ub9cc \uc811\uadfc \uac00\ub2a5 location / { {% for ip in values.allowedIPs % } allow { { ip }} ; {% endfor % } deny all ; # \ub098\uba38\uc9c0 \uc124\uc815... } # \uad00\ub9ac\uc790 \uc601\uc5ed \ubcf4\ud638 location /admin { allow 192 .168.1.0/24 ; # \ub0b4\ubd80 \ub124\ud2b8\uc6cc\ud06c\ub9cc deny all ; # \ub098\uba38\uc9c0 \uc124\uc815... }","title":"IP \uae30\ubc18 \uc811\uadfc \uc81c\uc5b4"},{"location":"security/#oauth2oidc","text":"OAuth2 Proxy\ub97c \uc0ac\uc6a9\ud55c \uc778\uc99d: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # oauth2-proxy.yaml apiVersion : apps/v1 kind : Deployment metadata : name : oauth2-proxy spec : replicas : 1 selector : matchLabels : app : oauth2-proxy template : metadata : labels : app : oauth2-proxy spec : containers : - name : oauth2-proxy image : quay.io/oauth2-proxy/oauth2-proxy:latest args : - --provider=oidc - --email-domain=* - --upstream=http://${{ values.name }}:80 - --http-address=0.0.0.0:4180 - --oidc-issuer-url=https://your-oidc-provider.com env : - name : OAUTH2_PROXY_CLIENT_ID valueFrom : secretKeyRef : name : oauth2-proxy-secret key : client-id - name : OAUTH2_PROXY_CLIENT_SECRET valueFrom : secretKeyRef : name : oauth2-proxy-secret key : client-secret - name : OAUTH2_PROXY_COOKIE_SECRET valueFrom : secretKeyRef : name : oauth2-proxy-secret key : cookie-secret","title":"OAuth2/OIDC \uc778\uc99d"},{"location":"security/#_3","text":"","title":"\ubcf4\uc548 \ud5e4\ub354"},{"location":"security/#_4","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # \ubcf4\uc548 \ud5e4\ub354 \uc124\uc815 add_header X-Frame-Options \"SAMEORIGIN\" always ; add_header X-XSS-Protection \"1 ; mode=block\" always ; add_header X-Content-Type-Options \"nosniff\" always ; add_header Referrer-Policy \"strict-origin-when-cross-origin\" always ; add_header Content-Security-Policy \"default-src 'self' ; script-src 'self' 'unsafe-inline' ; style-src 'self' 'unsafe-inline' ; img-src 'self' data: https: ; \" always ; {% if values.enableSSL % } # HSTS (HTTPS \uc804\uc6a9) add_header Strict-Transport-Security \"max-age=31536000 ; includeSubDomains ; preload\" always ; {% endif % } # \uc11c\ubc84 \uc815\ubcf4 \uc228\uae30\uae30 server_tokens off ; more_clear_headers Server ;","title":"\ud544\uc218 \ubcf4\uc548 \ud5e4\ub354"},{"location":"security/#csp-content-security-policy","text":"1 2 3 4 5 6 7 8 9 10 11 12 # \uc5c4\uaca9\ud55c CSP \uc815\ucc45 add_header Content-Security-Policy \" default-src 'self' ; script-src 'self' 'unsafe-inline' https://trusted-cdn.com ; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com ; font-src 'self' https://fonts.gstatic.com ; img-src 'self' data: https: ; connect-src 'self' https://api.example.com ; frame-ancestors 'none' ; base-uri 'self' ; form-action 'self' ; \" always ;","title":"CSP (Content Security Policy) \uc124\uc815"},{"location":"security/#ddos","text":"{% if values.enableRateLimit %}","title":"\uc18d\ub3c4 \uc81c\ud55c \ubc0f DDoS \ubc29\uc5b4"},{"location":"security/#_5","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # IP\ubcc4 \uc18d\ub3c4 \uc81c\ud55c limit_req_zone $binary_remote_addr zone=api:10m rate= ${{ values.rateLimitRpm }} r/m ; limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m ; # \uc5f0\uacb0 \uc218 \uc81c\ud55c limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m ; server { # \uc77c\ubc18 \uc694\uccad \uc81c\ud55c limit_req zone=api burst=20 nodelay ; # \uc5f0\uacb0 \uc218 \uc81c\ud55c limit_conn conn_limit_per_ip 10 ; # \ub85c\uadf8\uc778 \ud398\uc774\uc9c0 \ubcf4\ud638 location /login { limit_req zone=login burst=5 nodelay ; # \ub098\uba38\uc9c0 \uc124\uc815... } }","title":"\uae30\ubcf8 \uc18d\ub3c4 \uc81c\ud55c"},{"location":"security/#ddos_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # \ub300\uc6a9\ub7c9 \uc694\uccad \ucc28\ub2e8 client_max_body_size 10m ; client_body_buffer_size 128k ; client_header_buffer_size 1k ; large_client_header_buffers 4 4k ; # \ub290\ub9b0 \uacf5\uaca9 \ubc29\uc5b4 client_body_timeout 12 ; client_header_timeout 12 ; keepalive_timeout 15 ; send_timeout 10 ; # \uc758\uc2ec\uc2a4\ub7ec\uc6b4 User-Agent \ucc28\ub2e8 map $http_user_agent $blocked_agent { ~*malicious 1 ; ~*bot 1 ; ~*crawler 1 ; default 0 ; } server { if ( $blocked_agent ) { return 403 ; } }","title":"\uace0\uae09 DDoS \ubc29\uc5b4"},{"location":"security/#_6","text":"","title":"\ub85c\uadf8 \ubcf4\uc548"},{"location":"security/#_7","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # \ubbfc\uac10\ud55c \ud30c\ub77c\ubbf8\ud130 \ub85c\uae45 \uc81c\uc678 map $request_uri $loggable { ~*password 0 ; ~*token 0 ; ~*secret 0 ; default 1 ; } # \uc870\uac74\ubd80 \ub85c\uae45 access_log /var/log/nginx/access.log combined if= $loggable ; # \ubbfc\uac10 \uc815\ubcf4 \ub9c8\uc2a4\ud0b9 \ub85c\uadf8 \ud615\uc2dd log_format secure ' $remote_addr - $remote_user [ $time_local] ' '\" $request_method $uri $server_protocol\" ' ' $status $body_bytes_sent ' '\" $http_referer\" \" $http_user_agent\"' ;","title":"\ubbfc\uac10 \uc815\ubcf4 \ub9c8\uc2a4\ud0b9"},{"location":"security/#_8","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # \ub85c\uadf8 \ud30c\uc77c \uad8c\ud55c \uc124\uc815 chmod 640 /var/log/nginx/*.log chown nginx:adm /var/log/nginx/*.log # \ub85c\uadf8 \ub85c\ud14c\uc774\uc158 \ubcf4\uc548 \uc124\uc815 # /etc/logrotate.d/nginx /var/log/nginx/*.log { daily missingok rotate 52 compress delaycompress notifempty create 640 nginx adm sharedscripts postrotate if [ -f /var/run/nginx.pid ] ; then kill -USR1 ` cat /var/run/nginx.pid ` fi endscript }","title":"\ub85c\uadf8 \ud30c\uc77c \ubcf4\uc548"},{"location":"security/#_9","text":"","title":"\ucee8\ud14c\uc774\ub108 \ubcf4\uc548"},{"location":"security/#docker","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # Dockerfile \ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840 FROM nginx:${{ values.nginxVersion }} # \ube44\ud2b9\uad8c \uc0ac\uc6a9\uc790\ub85c \uc2e4\ud589 RUN groupadd -r nginx && useradd -r -g nginx nginx # \ubd88\ud544\uc694\ud55c \ud328\ud0a4\uc9c0 \uc81c\uac70 RUN apt-get update && apt-get install -y --no-install-recommends \\ ca-certificates \\ && rm -rf /var/lib/apt/lists/* # \ud30c\uc77c \uad8c\ud55c \uc124\uc815 COPY --chown = nginx:nginx config/ /etc/nginx/ COPY --chown = nginx:nginx html/ /usr/share/nginx/html/ # \ubcf4\uc548 \uc124\uc815 RUN chmod -R 644 /etc/nginx/ && \\ chmod -R 644 /usr/share/nginx/html/ && \\ chmod 755 /etc/nginx/conf.d/ USER nginx EXPOSE 8080 CMD [ \"nginx\" , \"-g\" , \"daemon off;\" ]","title":"Docker \ubcf4\uc548 \uc124\uc815"},{"location":"security/#kubernetes","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # security-context.yaml apiVersion : apps/v1 kind : Deployment metadata : name : ${{ values.name }} spec : template : spec : securityContext : runAsNonRoot : true runAsUser : 101 runAsGroup : 101 fsGroup : 101 containers : - name : nginx image : nginx:${{ values.nginxVersion }} securityContext : allowPrivilegeEscalation : false readOnlyRootFilesystem : true capabilities : drop : - ALL add : - NET_BIND_SERVICE resources : limits : memory : \"128Mi\" cpu : \"500m\" requests : memory : \"64Mi\" cpu : \"250m\"","title":"Kubernetes \ubcf4\uc548 \uc124\uc815"},{"location":"security/#pod-security-standards","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # pod-security-policy.yaml apiVersion : policy/v1beta1 kind : PodSecurityPolicy metadata : name : ${{ values.name }}-psp spec : privileged : false allowPrivilegeEscalation : false requiredDropCapabilities : - ALL volumes : - 'configMap' - 'emptyDir' - 'projected' - 'secret' - 'downwardAPI' - 'persistentVolumeClaim' runAsUser : rule : 'MustRunAsNonRoot' seLinux : rule : 'RunAsAny' fsGroup : rule : 'RunAsAny'","title":"Pod Security Standards"},{"location":"security/#_10","text":"","title":"\ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548"},{"location":"security/#network-policies","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # network-policy.yaml apiVersion : networking.k8s.io/v1 kind : NetworkPolicy metadata : name : ${{ values.name }}-netpol namespace : ${{ values.namespace }} spec : podSelector : matchLabels : app : ${{ values.name }} policyTypes : - Ingress - Egress ingress : - from : - namespaceSelector : matchLabels : name : ingress-nginx ports : - protocol : TCP port : 80 egress : - to : [] ports : - protocol : TCP port : 53 - protocol : UDP port : 53","title":"Network Policies"},{"location":"security/#service-mesh-istio","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # istio-security.yaml apiVersion : security.istio.io/v1beta1 kind : PeerAuthentication metadata : name : ${{ values.name }}-peer-auth namespace : ${{ values.namespace }} spec : selector : matchLabels : app : ${{ values.name }} mtls : mode : STRICT --- apiVersion : security.istio.io/v1beta1 kind : AuthorizationPolicy metadata : name : ${{ values.name }}-authz namespace : ${{ values.namespace }} spec : selector : matchLabels : app : ${{ values.name }} rules : - from : - source : principals : [ \"cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account\" ]","title":"Service Mesh \ubcf4\uc548 (Istio)"},{"location":"security/#_11","text":"","title":"\ubcf4\uc548 \uc2a4\uce90\ub2dd"},{"location":"security/#_12","text":"1 2 3 4 5 # Trivy\ub97c \uc0ac\uc6a9\ud55c \ucde8\uc57d\uc810 \uc2a4\uce94 trivy image nginx: ${ { values.nginxVersion } } # Clair\ub97c \uc0ac\uc6a9\ud55c \uc2a4\uce94 clairctl analyze nginx: ${ { values.nginxVersion } }","title":"\ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \uc2a4\uce94"},{"location":"security/#_13","text":"1 2 3 4 5 6 7 8 # NGINX \uc124\uc815 \ubcf4\uc548 \uac80\uc0ac nginx -t -c /etc/nginx/nginx.conf # SSL \uc124\uc815 \ud14c\uc2a4\ud2b8 testssl.sh { % if values.domain % } ${ { values.domain } }{ % else % } localhost { % endif % } # \ubcf4\uc548 \ud5e4\ub354 \uac80\uc0ac curl -I { % if values.enableSSL and values.domain % } https:// ${ { values.domain } }{ % else % } http://localhost: ${ { values.port } }{ % endif % }","title":"\uc124\uc815 \ubcf4\uc548 \uac80\uc0ac"},{"location":"security/#_14","text":"","title":"\ubcf4\uc548 \ubaa8\ub2c8\ud130\ub9c1"},{"location":"security/#_15","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # \ubcf4\uc548 \uc774\ubca4\ud2b8 \ub85c\uadf8 \ud615\uc2dd log_format security ' $remote_addr - $remote_user [ $time_local] ' '\" $request\" $status $body_bytes_sent ' '\" $http_referer\" \" $http_user_agent\" ' 'rt= $request_time ua=\" $upstream_addr\" ' 'us=\" $upstream_status\" ut=\" $upstream_response_time\"' ; # \ubcf4\uc548 \uc774\ubca4\ud2b8\ub9cc \ubcc4\ub3c4 \ub85c\uae45 map $status $security_log { ~^4 1 ; # 4xx \uc5d0\ub7ec ~^5 1 ; # 5xx \uc5d0\ub7ec default 0 ; } access_log /var/log/nginx/security.log security if= $security_log ;","title":"\ubcf4\uc548 \uc774\ubca4\ud2b8 \ub85c\uae45"},{"location":"security/#_16","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Fail2ban \uc124\uc815 # /etc/fail2ban/jail.local [ nginx-http-auth ] enabled = true filter = nginx-http-auth logpath = /var/log/nginx/error.log maxretry = 5 bantime = 3600 [ nginx-noscript ] enabled = true filter = nginx-noscript logpath = /var/log/nginx/access.log maxretry = 6 bantime = 86400","title":"\uce68\uc785 \ud0d0\uc9c0"},{"location":"security/#_17","text":"","title":"\ubcf4\uc548 \uccb4\ud06c\ub9ac\uc2a4\ud2b8"},{"location":"security/#_18","text":"SSL/TLS \uc778\uc99d\uc11c \uc124\uc815 \ubc0f \uac80\uc99d \ubcf4\uc548 \ud5e4\ub354 \uc124\uc815 \ud655\uc778 \uc811\uadfc \uc81c\uc5b4 \uc815\ucc45 \uac80\ud1a0 \uc18d\ub3c4 \uc81c\ud55c \uc124\uc815 \ud655\uc778 \ub85c\uadf8 \uc124\uc815 \ubc0f \ubbfc\uac10 \uc815\ubcf4 \ub9c8\uc2a4\ud0b9 \ucee8\ud14c\uc774\ub108 \ubcf4\uc548 \uc124\uc815 \uac80\ud1a0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc124\uc815 \ucde8\uc57d\uc810 \uc2a4\uce94 \uc2e4\ud589 \ubcf4\uc548 \ud14c\uc2a4\ud2b8 \uc218\ud589","title":"\ubc30\ud3ec \uc804 \uccb4\ud06c\ub9ac\uc2a4\ud2b8"},{"location":"security/#_19","text":"\uc778\uc99d\uc11c \ub9cc\ub8cc\uc77c \ud655\uc778 \ubcf4\uc548 \ud328\uce58 \uc801\uc6a9 \ub85c\uadf8 \ubd84\uc11d \ubc0f \uc774\uc0c1 \uc9d5\ud6c4 \ud655\uc778 \uc811\uadfc \uad8c\ud55c \uac80\ud1a0 \ubc31\uc5c5 \ubc0f \ubcf5\uad6c \ud14c\uc2a4\ud2b8 \ubcf4\uc548 \uc815\ucc45 \uc5c5\ub370\uc774\ud2b8","title":"\uc815\uae30 \ubcf4\uc548 \uc810\uac80"},{"location":"security/#_20","text":"\ubcf4\uc548 \uad00\ub828 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 Troubleshooting \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.","title":"\ubb38\uc81c \ud574\uacb0"},{"location":"troubleshooting/","text":"Troubleshooting Guide \u00b6 \uc774 \uac00\uc774\ub4dc\ub294 nginx-test-service \uc11c\ube44\uc2a4\uc5d0\uc11c \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc77c\ubc18\uc801\uc778 \ubb38\uc81c\uc640 \ud574\uacb0 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc778 \ubb38\uc81c \u00b6 1. \uc11c\ube44\uc2a4 \uc2dc\uc791 \uc2e4\ud328 \u00b6 \uc99d\uc0c1 \u00b6 \ucee8\ud14c\uc774\ub108\uac00 \uc2dc\uc791\ub418\uc9c0 \uc54a\uc74c Pod\uac00 CrashLoopBackOff \uc0c1\ud0dc \uc6d0\uc778 \ubc0f \ud574\uacb0\ubc29\ubc95 \u00b6 \ud3ec\ud2b8 \ucda9\ub3cc 1 2 3 4 5 6 # \ud3ec\ud2b8 \uc0ac\uc6a9 \ud655\uc778 netstat -tulpn | grep :8082 lsof -i :8082 # \ud574\uacb0: \ub2e4\ub978 \ud3ec\ud2b8 \uc0ac\uc6a9 \ub610\ub294 \uae30\uc874 \ud504\ub85c\uc138\uc2a4 \uc885\ub8cc sudo kill -9 <PID> NGINX \uc124\uc815 \uc624\ub958 1 2 3 4 5 6 7 8 9 10 # \uc124\uc815 \ud30c\uc77c \ubb38\ubc95 \uac80\uc0ac nginx -t -c /path/to/nginx.conf # Docker\uc5d0\uc11c \uc124\uc815 \uac80\uc0ac docker run --rm -v $PWD /config:/etc/nginx/conf.d nginx:1.25 nginx -t # \uc77c\ubc18\uc801\uc778 \uc124\uc815 \uc624\ub958 # 1. \uc138\ubbf8\ucf5c\ub860 \ub204\ub77d # 2. \uc911\uad04\ud638 \ubd88\uc77c\uce58 # 3. \uc798\ubabb\ub41c \uc9c0\uc2dc\uc5b4 \uc0ac\uc6a9 \uad8c\ud55c \ubb38\uc81c 1 2 3 4 5 6 7 # \ud30c\uc77c \uad8c\ud55c \ud655\uc778 ls -la config/ ls -la html/ # \uad8c\ud55c \uc218\uc815 chmod 644 config/*.conf chmod -R 644 html/ 2. \uc5f0\uacb0 \ubb38\uc81c \u00b6 \uc99d\uc0c1 \u00b6 \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c \uc811\uc18d \ubd88\uac00 \"Connection refused\" \uc624\ub958 \ud574\uacb0\ubc29\ubc95 \u00b6 \uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 1 2 3 4 5 6 7 8 # Docker Compose docker-compose ps docker-compose logs nginx # Kubernetes kubectl get pods -n ${ { values.namespace } } kubectl logs deployment/ ${ { values.name } } -n ${ { values.namespace } } kubectl describe pod <pod-name> -n ${ { values.namespace } } \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \ud14c\uc2a4\ud2b8 1 2 3 4 5 6 7 8 # \ub85c\uceec \uc5f0\uacb0 \ud14c\uc2a4\ud2b8 curl -I http://localhost:8082 # \ucee8\ud14c\uc774\ub108 \ub0b4\ubd80\uc5d0\uc11c \ud14c\uc2a4\ud2b8 docker exec -it <container-name> curl -I http://localhost:80 # Kubernetes \ud3ec\ud2b8 \ud3ec\uc6cc\ub529 kubectl port-forward svc/ ${ { values.name } } ${ { values.port } } :80 -n ${ { values.namespace } } \ubc29\ud654\ubcbd \ud655\uc778 1 2 3 4 5 6 7 8 # iptables \uaddc\uce59 \ud655\uc778 sudo iptables -L # UFW \uc0c1\ud0dc \ud655\uc778 (Ubuntu) sudo ufw status # \ud3ec\ud2b8 \uc5f4\uae30 sudo ufw allow ${ { values.port } } 3. SSL/TLS \ubb38\uc81c \u00b6 {% if values.enableSSL %} \uc99d\uc0c1 \u00b6 SSL \uc778\uc99d\uc11c \uc624\ub958 \"Your connection is not private\" \uacbd\uace0 \ud574\uacb0\ubc29\ubc95 \u00b6 \uc778\uc99d\uc11c \uc0c1\ud0dc \ud655\uc778 1 2 3 4 5 6 7 8 # \uc778\uc99d\uc11c \uc815\ubcf4 \ud655\uc778 openssl x509 -in /path/to/certificate.crt -text -noout # \uc778\uc99d\uc11c \ub9cc\ub8cc\uc77c \ud655\uc778 openssl x509 -in /path/to/certificate.crt -noout -dates # \uc628\ub77c\uc778 SSL \ud14c\uc2a4\ud2b8 curl -vI https:// ${ { values.domain } } Kubernetes Secret \ud655\uc778 1 2 3 4 5 6 7 8 # Secret \uc874\uc7ac \ud655\uc778 kubectl get secret ${ { values.name } } -tls -n ${ { values.namespace } } # Secret \ub0b4\uc6a9 \ud655\uc778 kubectl describe secret ${ { values.name } } -tls -n ${ { values.namespace } } # \uc778\uc99d\uc11c \ub514\ucf54\ub529 kubectl get secret ${ { values.name } } -tls -n ${ { values.namespace } } -o jsonpath = '{.data.tls\\.crt}' | base64 -d | openssl x509 -text -noout {% if values.sslProvider == \"cert-manager\" %} Cert-Manager \ubb38\uc81c 1 2 3 4 5 6 7 8 9 # Certificate \uc0c1\ud0dc \ud655\uc778 kubectl get certificate -n ${ { values.namespace } } kubectl describe certificate ${ { values.name } } -tls -n ${ { values.namespace } } # CertificateRequest \ud655\uc778 kubectl get certificaterequest -n ${ { values.namespace } } # Cert-Manager \ub85c\uadf8 \ud655\uc778 kubectl logs -n cert-manager deployment/cert-manager {% endif %} 4. \uc131\ub2a5 \ubb38\uc81c \u00b6 \uc99d\uc0c1 \u00b6 \uc751\ub2f5 \uc18d\ub3c4 \ub290\ub9bc \ub192\uc740 CPU/\uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960 \ud574\uacb0\ubc29\ubc95 \u00b6 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 \ud655\uc778 1 2 3 4 5 6 7 8 9 10 11 12 # \uc2dc\uc2a4\ud15c \ub9ac\uc18c\uc2a4 \ud655\uc778 top htop free -h df -h # Docker \ucee8\ud14c\uc774\ub108 \ub9ac\uc18c\uc2a4 \ud655\uc778 docker stats # Kubernetes \ub9ac\uc18c\uc2a4 \ud655\uc778 kubectl top pods -n ${ { values.namespace } } kubectl top nodes NGINX \uc131\ub2a5 \ud29c\ub2dd 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # worker_processes \ucd5c\uc801\ud654 worker_processes auto ; # \uc5f0\uacb0 \uc218 \uc99d\uac00 events { worker_connections 2048 ; use epoll ; multi_accept on ; } # \ubc84\ud37c \ud06c\uae30 \uc870\uc815 http { client_body_buffer_size 128k ; client_max_body_size 10m ; client_header_buffer_size 1k ; large_client_header_buffers 4 4k ; } \uce90\uc2dc \uc124\uc815 \ud655\uc778 {% if values.enableCaching %} 1 2 3 4 5 # \uce90\uc2dc \ub514\ub809\ud1a0\ub9ac \ud655\uc778 ls -la /var/cache/nginx/ # \uce90\uc2dc \ud1b5\uacc4 \ud655\uc778 curl http://localhost/nginx_status 5. \ub85c\uadf8 \uad00\ub828 \ubb38\uc81c \u00b6 \uc99d\uc0c1 \u00b6 \ub85c\uadf8\uac00 \uc0dd\uc131\ub418\uc9c0 \uc54a\uc74c \ub85c\uadf8 \ud30c\uc77c\uc774 \ub108\ubb34 \ud07c \ud574\uacb0\ubc29\ubc95 \u00b6 \ub85c\uadf8 \uc124\uc815 \ud655\uc778 1 2 3 4 5 6 7 8 9 # \ub85c\uadf8 \ud30c\uc77c \uc704\uce58 \ud655\uc778 ls -la /var/log/nginx/ # \ub85c\uadf8 \ud30c\uc77c \uad8c\ud55c \ud655\uc778 ls -la /var/log/nginx/*.log # \uc2e4\uc2dc\uac04 \ub85c\uadf8 \ud655\uc778 tail -f /var/log/nginx/access.log tail -f /var/log/nginx/error.log \ub85c\uadf8 \ub85c\ud14c\uc774\uc158 \uc124\uc815 1 2 3 4 5 6 7 8 # logrotate \uc124\uc815 \ud655\uc778 cat /etc/logrotate.d/nginx # \uc218\ub3d9 \ub85c\uadf8 \ub85c\ud14c\uc774\uc158 sudo logrotate -f /etc/logrotate.d/nginx # \ub85c\uadf8 \uc555\ucd95 \ubc0f \uc815\ub9ac find /var/log/nginx/ -name \"*.log.*\" -mtime +30 -delete 6. \ubaa8\ub2c8\ud130\ub9c1 \ubb38\uc81c \u00b6 {% if values.enableMonitoring %} \uc99d\uc0c1 \u00b6 Prometheus \uba54\ud2b8\ub9ad\uc774 \uc218\uc9d1\ub418\uc9c0 \uc54a\uc74c Grafana \ub300\uc2dc\ubcf4\ub4dc\uc5d0 \ub370\uc774\ud130 \uc5c6\uc74c \ud574\uacb0\ubc29\ubc95 \u00b6 Exporter \uc0c1\ud0dc \ud655\uc778 1 2 3 4 5 6 # Exporter \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ud14c\uc2a4\ud2b8 curl http://localhost:9114/metrics # Exporter \ub85c\uadf8 \ud655\uc778 docker logs <nginx-exporter-container> kubectl logs deployment/ ${ { values.name } } -exporter -n ${ { values.namespace } } Prometheus \uc124\uc815 \ud655\uc778 1 2 3 4 5 # Prometheus \ud0c0\uac9f \ud655\uc778 curl http://prometheus:9090/api/v1/targets # \uba54\ud2b8\ub9ad \ucffc\ub9ac \ud14c\uc2a4\ud2b8 curl 'http://prometheus:9090/api/v1/query?query=nginx_connections_active' \ub514\ubc84\uae45 \ub3c4\uad6c \u00b6 1. \ub85c\uadf8 \ubd84\uc11d \ub3c4\uad6c \u00b6 1 2 3 4 5 6 7 8 # \uc5d0\ub7ec \ub85c\uadf8 \ubd84\uc11d grep \"error\" /var/log/nginx/error.log | tail -20 # \uc811\uadfc \ub85c\uadf8 \ubd84\uc11d awk '$9 >= 400' /var/log/nginx/access.log | tail -20 # \uc751\ub2f5 \uc2dc\uac04 \ubd84\uc11d awk '{print $NF}' /var/log/nginx/access.log | sort -n | tail -10 2. \ub124\ud2b8\uc6cc\ud06c \ub514\ubc84\uae45 \u00b6 1 2 3 4 5 6 7 8 9 10 # \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \uc0c1\ud0dc netstat -tulpn | grep nginx ss -tulpn | grep nginx # DNS \ud574\uc11d \ud655\uc778 nslookup ${ { values.domain } } dig ${ { values.domain } } # \ub124\ud2b8\uc6cc\ud06c \uacbd\ub85c \ucd94\uc801 traceroute ${ { values.domain } } 3. \uc131\ub2a5 \ubd84\uc11d \u00b6 1 2 3 4 5 6 7 8 9 10 11 # \uc2dc\uc2a4\ud15c \uc131\ub2a5 \ubaa8\ub2c8\ud130\ub9c1 iostat -x 1 vmstat 1 sar -u 1 # NGINX \ud504\ub85c\uc138\uc2a4 \ubd84\uc11d ps aux | grep nginx pstree -p nginx # \ud30c\uc77c \ub514\uc2a4\ud06c\ub9bd\ud130 \ud655\uc778 lsof -p <nginx-pid> \ubb38\uc81c\ubcc4 \uccb4\ud06c\ub9ac\uc2a4\ud2b8 \u00b6 \uc11c\ube44\uc2a4 \uc2dc\uc791 \uc2e4\ud328 \u00b6 \ud3ec\ud2b8 \ucda9\ub3cc \ud655\uc778 NGINX \uc124\uc815 \ubb38\ubc95 \uac80\uc0ac \ud30c\uc77c \uad8c\ud55c \ud655\uc778 \ub85c\uadf8 \ud30c\uc77c \ud655\uc778 \ub9ac\uc18c\uc2a4 \uc81c\ud55c \ud655\uc778 \uc5f0\uacb0 \ubb38\uc81c \u00b6 \uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \ud14c\uc2a4\ud2b8 \ubc29\ud654\ubcbd \uc124\uc815 \ud655\uc778 DNS \ud574\uc11d \ud655\uc778 \ud504\ub85d\uc2dc \uc124\uc815 \ud655\uc778 \uc131\ub2a5 \ubb38\uc81c \u00b6 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 \ud655\uc778 NGINX \uc124\uc815 \ucd5c\uc801\ud654 \uce90\uc2dc \uc124\uc815 \ud655\uc778 \ub85c\ub4dc \ubc38\ub7f0\uc2f1 \ud655\uc778 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc5f0\uacb0 \ud655\uc778 SSL/TLS \ubb38\uc81c \u00b6 \uc778\uc99d\uc11c \uc720\ud6a8\uc131 \ud655\uc778 \uc778\uc99d\uc11c \ub9cc\ub8cc\uc77c \ud655\uc778 SSL \uc124\uc815 \uac80\ud1a0 \uc911\uac04 \uc778\uc99d\uc11c \ud655\uc778 \uc554\ud638\ud654 \uc2a4\uc704\ud2b8 \ud655\uc778 \uc751\uae09 \ubcf5\uad6c \uc808\ucc28 \u00b6 1. \uc11c\ube44\uc2a4 \ub864\ubc31 \u00b6 1 2 3 4 5 6 7 8 # Docker Compose \ub864\ubc31 docker-compose down git checkout HEAD~1 -- docker-compose.yml docker-compose up -d # Kubernetes \ub864\ubc31 kubectl rollout undo deployment/ ${ { values.name } } -n ${ { values.namespace } } kubectl rollout status deployment/ ${ { values.name } } -n ${ { values.namespace } } 2. \uc124\uc815 \ubcf5\uad6c \u00b6 1 2 3 4 5 6 7 # \ubc31\uc5c5\uc5d0\uc11c \uc124\uc815 \ubcf5\uad6c cp /backup/nginx.conf.backup config/nginx.conf docker-compose restart nginx # Git\uc5d0\uc11c \uc124\uc815 \ubcf5\uad6c git checkout HEAD -- config/ docker-compose restart nginx 3. \ud2b8\ub798\ud53d \uc6b0\ud68c \u00b6 1 2 3 4 5 # \uc720\uc9c0\ubcf4\uc218 \ud398\uc774\uc9c0 \ud65c\uc131\ud654 cp maintenance.html html/index.html # \ub85c\ub4dc \ubc38\ub7f0\uc11c\uc5d0\uc11c \uc11c\ubc84 \uc81c\uc678 # (\ub85c\ub4dc \ubc38\ub7f0\uc11c\ubcc4 \uc124\uc815 \ubc29\ubc95 \ucc38\uc870) \ub85c\uadf8 \uc218\uc9d1 \uc2a4\ud06c\ub9bd\ud2b8 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/bin/bash # collect-logs.sh TIMESTAMP = $( date +%Y%m%d_%H%M%S ) LOG_DIR = \"/tmp/nginx-logs- $TIMESTAMP \" mkdir -p $LOG_DIR echo \"Collecting NGINX logs and diagnostics...\" # \uae30\ubcf8 \uc815\ubcf4 echo \"=== System Information ===\" > $LOG_DIR /system-info.txt uname -a >> $LOG_DIR /system-info.txt date >> $LOG_DIR /system-info.txt # NGINX \uc124\uc815 echo \"=== NGINX Configuration ===\" > $LOG_DIR /nginx-config.txt nginx -T >> $LOG_DIR /nginx-config.txt 2 > & 1 # \ub85c\uadf8 \ud30c\uc77c cp /var/log/nginx/*.log $LOG_DIR / 2 >/dev/null # \ud504\ub85c\uc138\uc2a4 \uc815\ubcf4 echo \"=== Process Information ===\" > $LOG_DIR /process-info.txt ps aux | grep nginx >> $LOG_DIR /process-info.txt # \ub124\ud2b8\uc6cc\ud06c \uc815\ubcf4 echo \"=== Network Information ===\" > $LOG_DIR /network-info.txt netstat -tulpn | grep nginx >> $LOG_DIR /network-info.txt # Docker/Kubernetes \uc815\ubcf4 if command -v docker & > /dev/null ; then echo \"=== Docker Information ===\" > $LOG_DIR /docker-info.txt docker ps | grep nginx >> $LOG_DIR /docker-info.txt docker logs nginx >> $LOG_DIR /docker-logs.txt 2 > & 1 fi if command -v kubectl & > /dev/null ; then echo \"=== Kubernetes Information ===\" > $LOG_DIR /k8s-info.txt kubectl get pods -n ${ { values.namespace } } >> $LOG_DIR /k8s-info.txt kubectl describe deployment/ ${ { values.name } } -n ${ { values.namespace } } >> $LOG_DIR /k8s-describe.txt kubectl logs deployment/ ${ { values.name } } -n ${ { values.namespace } } >> $LOG_DIR /k8s-logs.txt fi # \uc555\ucd95 tar -czf nginx-diagnostics- $TIMESTAMP .tar.gz -C /tmp nginx-logs- $TIMESTAMP / echo \"Diagnostics collected: nginx-diagnostics- $TIMESTAMP .tar.gz\" \uc9c0\uc6d0 \uc5f0\ub77d\ucc98 \u00b6 \ubb38\uc81c\uac00 \ud574\uacb0\ub418\uc9c0 \uc54a\uc73c\uba74 \ub2e4\uc74c \ucc44\ub110\uc744 \ud1b5\ud574 \uc9c0\uc6d0\uc744 \uc694\uccad\ud558\uc138\uc694: GitHub Issues : test-org/nginx-test-service/issues Platform Team : platform-team@company.com \uae34\uae09 \uc0c1\ud669 : +82-10-XXXX-XXXX (24/7 \uc9c0\uc6d0) \uc9c0\uc6d0 \uc694\uccad \uc2dc \ud3ec\ud568\ud560 \uc815\ubcf4 \u00b6 \ubb38\uc81c \ubc1c\uc0dd \uc2dc\uac04 \uc624\ub958 \uba54\uc2dc\uc9c0 (\uc804\uccb4 \uc2a4\ud0dd \ud2b8\ub808\uc774\uc2a4) \ub85c\uadf8 \ud30c\uc77c (\uc704 \uc2a4\ud06c\ub9bd\ud2b8\ub85c \uc218\uc9d1) \ud658\uacbd \uc815\ubcf4 (OS, Docker/Kubernetes \ubc84\uc804) \ucd5c\uadfc \ubcc0\uacbd\uc0ac\ud56d \uc7ac\ud604 \ub2e8\uacc4","title":"Troubleshooting"},{"location":"troubleshooting/#troubleshooting-guide","text":"\uc774 \uac00\uc774\ub4dc\ub294 nginx-test-service \uc11c\ube44\uc2a4\uc5d0\uc11c \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc77c\ubc18\uc801\uc778 \ubb38\uc81c\uc640 \ud574\uacb0 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4.","title":"Troubleshooting Guide"},{"location":"troubleshooting/#_1","text":"","title":"\uc77c\ubc18\uc801\uc778 \ubb38\uc81c"},{"location":"troubleshooting/#1","text":"","title":"1. \uc11c\ube44\uc2a4 \uc2dc\uc791 \uc2e4\ud328"},{"location":"troubleshooting/#_2","text":"\ucee8\ud14c\uc774\ub108\uac00 \uc2dc\uc791\ub418\uc9c0 \uc54a\uc74c Pod\uac00 CrashLoopBackOff \uc0c1\ud0dc","title":"\uc99d\uc0c1"},{"location":"troubleshooting/#_3","text":"\ud3ec\ud2b8 \ucda9\ub3cc 1 2 3 4 5 6 # \ud3ec\ud2b8 \uc0ac\uc6a9 \ud655\uc778 netstat -tulpn | grep :8082 lsof -i :8082 # \ud574\uacb0: \ub2e4\ub978 \ud3ec\ud2b8 \uc0ac\uc6a9 \ub610\ub294 \uae30\uc874 \ud504\ub85c\uc138\uc2a4 \uc885\ub8cc sudo kill -9 <PID> NGINX \uc124\uc815 \uc624\ub958 1 2 3 4 5 6 7 8 9 10 # \uc124\uc815 \ud30c\uc77c \ubb38\ubc95 \uac80\uc0ac nginx -t -c /path/to/nginx.conf # Docker\uc5d0\uc11c \uc124\uc815 \uac80\uc0ac docker run --rm -v $PWD /config:/etc/nginx/conf.d nginx:1.25 nginx -t # \uc77c\ubc18\uc801\uc778 \uc124\uc815 \uc624\ub958 # 1. \uc138\ubbf8\ucf5c\ub860 \ub204\ub77d # 2. \uc911\uad04\ud638 \ubd88\uc77c\uce58 # 3. \uc798\ubabb\ub41c \uc9c0\uc2dc\uc5b4 \uc0ac\uc6a9 \uad8c\ud55c \ubb38\uc81c 1 2 3 4 5 6 7 # \ud30c\uc77c \uad8c\ud55c \ud655\uc778 ls -la config/ ls -la html/ # \uad8c\ud55c \uc218\uc815 chmod 644 config/*.conf chmod -R 644 html/","title":"\uc6d0\uc778 \ubc0f \ud574\uacb0\ubc29\ubc95"},{"location":"troubleshooting/#2","text":"","title":"2. \uc5f0\uacb0 \ubb38\uc81c"},{"location":"troubleshooting/#_4","text":"\ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c \uc811\uc18d \ubd88\uac00 \"Connection refused\" \uc624\ub958","title":"\uc99d\uc0c1"},{"location":"troubleshooting/#_5","text":"\uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 1 2 3 4 5 6 7 8 # Docker Compose docker-compose ps docker-compose logs nginx # Kubernetes kubectl get pods -n ${ { values.namespace } } kubectl logs deployment/ ${ { values.name } } -n ${ { values.namespace } } kubectl describe pod <pod-name> -n ${ { values.namespace } } \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \ud14c\uc2a4\ud2b8 1 2 3 4 5 6 7 8 # \ub85c\uceec \uc5f0\uacb0 \ud14c\uc2a4\ud2b8 curl -I http://localhost:8082 # \ucee8\ud14c\uc774\ub108 \ub0b4\ubd80\uc5d0\uc11c \ud14c\uc2a4\ud2b8 docker exec -it <container-name> curl -I http://localhost:80 # Kubernetes \ud3ec\ud2b8 \ud3ec\uc6cc\ub529 kubectl port-forward svc/ ${ { values.name } } ${ { values.port } } :80 -n ${ { values.namespace } } \ubc29\ud654\ubcbd \ud655\uc778 1 2 3 4 5 6 7 8 # iptables \uaddc\uce59 \ud655\uc778 sudo iptables -L # UFW \uc0c1\ud0dc \ud655\uc778 (Ubuntu) sudo ufw status # \ud3ec\ud2b8 \uc5f4\uae30 sudo ufw allow ${ { values.port } }","title":"\ud574\uacb0\ubc29\ubc95"},{"location":"troubleshooting/#3-ssltls","text":"{% if values.enableSSL %}","title":"3. SSL/TLS \ubb38\uc81c"},{"location":"troubleshooting/#_6","text":"SSL \uc778\uc99d\uc11c \uc624\ub958 \"Your connection is not private\" \uacbd\uace0","title":"\uc99d\uc0c1"},{"location":"troubleshooting/#_7","text":"\uc778\uc99d\uc11c \uc0c1\ud0dc \ud655\uc778 1 2 3 4 5 6 7 8 # \uc778\uc99d\uc11c \uc815\ubcf4 \ud655\uc778 openssl x509 -in /path/to/certificate.crt -text -noout # \uc778\uc99d\uc11c \ub9cc\ub8cc\uc77c \ud655\uc778 openssl x509 -in /path/to/certificate.crt -noout -dates # \uc628\ub77c\uc778 SSL \ud14c\uc2a4\ud2b8 curl -vI https:// ${ { values.domain } } Kubernetes Secret \ud655\uc778 1 2 3 4 5 6 7 8 # Secret \uc874\uc7ac \ud655\uc778 kubectl get secret ${ { values.name } } -tls -n ${ { values.namespace } } # Secret \ub0b4\uc6a9 \ud655\uc778 kubectl describe secret ${ { values.name } } -tls -n ${ { values.namespace } } # \uc778\uc99d\uc11c \ub514\ucf54\ub529 kubectl get secret ${ { values.name } } -tls -n ${ { values.namespace } } -o jsonpath = '{.data.tls\\.crt}' | base64 -d | openssl x509 -text -noout {% if values.sslProvider == \"cert-manager\" %} Cert-Manager \ubb38\uc81c 1 2 3 4 5 6 7 8 9 # Certificate \uc0c1\ud0dc \ud655\uc778 kubectl get certificate -n ${ { values.namespace } } kubectl describe certificate ${ { values.name } } -tls -n ${ { values.namespace } } # CertificateRequest \ud655\uc778 kubectl get certificaterequest -n ${ { values.namespace } } # Cert-Manager \ub85c\uadf8 \ud655\uc778 kubectl logs -n cert-manager deployment/cert-manager {% endif %}","title":"\ud574\uacb0\ubc29\ubc95"},{"location":"troubleshooting/#4","text":"","title":"4. \uc131\ub2a5 \ubb38\uc81c"},{"location":"troubleshooting/#_8","text":"\uc751\ub2f5 \uc18d\ub3c4 \ub290\ub9bc \ub192\uc740 CPU/\uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960","title":"\uc99d\uc0c1"},{"location":"troubleshooting/#_9","text":"\ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 \ud655\uc778 1 2 3 4 5 6 7 8 9 10 11 12 # \uc2dc\uc2a4\ud15c \ub9ac\uc18c\uc2a4 \ud655\uc778 top htop free -h df -h # Docker \ucee8\ud14c\uc774\ub108 \ub9ac\uc18c\uc2a4 \ud655\uc778 docker stats # Kubernetes \ub9ac\uc18c\uc2a4 \ud655\uc778 kubectl top pods -n ${ { values.namespace } } kubectl top nodes NGINX \uc131\ub2a5 \ud29c\ub2dd 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # worker_processes \ucd5c\uc801\ud654 worker_processes auto ; # \uc5f0\uacb0 \uc218 \uc99d\uac00 events { worker_connections 2048 ; use epoll ; multi_accept on ; } # \ubc84\ud37c \ud06c\uae30 \uc870\uc815 http { client_body_buffer_size 128k ; client_max_body_size 10m ; client_header_buffer_size 1k ; large_client_header_buffers 4 4k ; } \uce90\uc2dc \uc124\uc815 \ud655\uc778 {% if values.enableCaching %} 1 2 3 4 5 # \uce90\uc2dc \ub514\ub809\ud1a0\ub9ac \ud655\uc778 ls -la /var/cache/nginx/ # \uce90\uc2dc \ud1b5\uacc4 \ud655\uc778 curl http://localhost/nginx_status","title":"\ud574\uacb0\ubc29\ubc95"},{"location":"troubleshooting/#5","text":"","title":"5. \ub85c\uadf8 \uad00\ub828 \ubb38\uc81c"},{"location":"troubleshooting/#_10","text":"\ub85c\uadf8\uac00 \uc0dd\uc131\ub418\uc9c0 \uc54a\uc74c \ub85c\uadf8 \ud30c\uc77c\uc774 \ub108\ubb34 \ud07c","title":"\uc99d\uc0c1"},{"location":"troubleshooting/#_11","text":"\ub85c\uadf8 \uc124\uc815 \ud655\uc778 1 2 3 4 5 6 7 8 9 # \ub85c\uadf8 \ud30c\uc77c \uc704\uce58 \ud655\uc778 ls -la /var/log/nginx/ # \ub85c\uadf8 \ud30c\uc77c \uad8c\ud55c \ud655\uc778 ls -la /var/log/nginx/*.log # \uc2e4\uc2dc\uac04 \ub85c\uadf8 \ud655\uc778 tail -f /var/log/nginx/access.log tail -f /var/log/nginx/error.log \ub85c\uadf8 \ub85c\ud14c\uc774\uc158 \uc124\uc815 1 2 3 4 5 6 7 8 # logrotate \uc124\uc815 \ud655\uc778 cat /etc/logrotate.d/nginx # \uc218\ub3d9 \ub85c\uadf8 \ub85c\ud14c\uc774\uc158 sudo logrotate -f /etc/logrotate.d/nginx # \ub85c\uadf8 \uc555\ucd95 \ubc0f \uc815\ub9ac find /var/log/nginx/ -name \"*.log.*\" -mtime +30 -delete","title":"\ud574\uacb0\ubc29\ubc95"},{"location":"troubleshooting/#6","text":"{% if values.enableMonitoring %}","title":"6. \ubaa8\ub2c8\ud130\ub9c1 \ubb38\uc81c"},{"location":"troubleshooting/#_12","text":"Prometheus \uba54\ud2b8\ub9ad\uc774 \uc218\uc9d1\ub418\uc9c0 \uc54a\uc74c Grafana \ub300\uc2dc\ubcf4\ub4dc\uc5d0 \ub370\uc774\ud130 \uc5c6\uc74c","title":"\uc99d\uc0c1"},{"location":"troubleshooting/#_13","text":"Exporter \uc0c1\ud0dc \ud655\uc778 1 2 3 4 5 6 # Exporter \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ud14c\uc2a4\ud2b8 curl http://localhost:9114/metrics # Exporter \ub85c\uadf8 \ud655\uc778 docker logs <nginx-exporter-container> kubectl logs deployment/ ${ { values.name } } -exporter -n ${ { values.namespace } } Prometheus \uc124\uc815 \ud655\uc778 1 2 3 4 5 # Prometheus \ud0c0\uac9f \ud655\uc778 curl http://prometheus:9090/api/v1/targets # \uba54\ud2b8\ub9ad \ucffc\ub9ac \ud14c\uc2a4\ud2b8 curl 'http://prometheus:9090/api/v1/query?query=nginx_connections_active'","title":"\ud574\uacb0\ubc29\ubc95"},{"location":"troubleshooting/#_14","text":"","title":"\ub514\ubc84\uae45 \ub3c4\uad6c"},{"location":"troubleshooting/#1_1","text":"1 2 3 4 5 6 7 8 # \uc5d0\ub7ec \ub85c\uadf8 \ubd84\uc11d grep \"error\" /var/log/nginx/error.log | tail -20 # \uc811\uadfc \ub85c\uadf8 \ubd84\uc11d awk '$9 >= 400' /var/log/nginx/access.log | tail -20 # \uc751\ub2f5 \uc2dc\uac04 \ubd84\uc11d awk '{print $NF}' /var/log/nginx/access.log | sort -n | tail -10","title":"1. \ub85c\uadf8 \ubd84\uc11d \ub3c4\uad6c"},{"location":"troubleshooting/#2_1","text":"1 2 3 4 5 6 7 8 9 10 # \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \uc0c1\ud0dc netstat -tulpn | grep nginx ss -tulpn | grep nginx # DNS \ud574\uc11d \ud655\uc778 nslookup ${ { values.domain } } dig ${ { values.domain } } # \ub124\ud2b8\uc6cc\ud06c \uacbd\ub85c \ucd94\uc801 traceroute ${ { values.domain } }","title":"2. \ub124\ud2b8\uc6cc\ud06c \ub514\ubc84\uae45"},{"location":"troubleshooting/#3","text":"1 2 3 4 5 6 7 8 9 10 11 # \uc2dc\uc2a4\ud15c \uc131\ub2a5 \ubaa8\ub2c8\ud130\ub9c1 iostat -x 1 vmstat 1 sar -u 1 # NGINX \ud504\ub85c\uc138\uc2a4 \ubd84\uc11d ps aux | grep nginx pstree -p nginx # \ud30c\uc77c \ub514\uc2a4\ud06c\ub9bd\ud130 \ud655\uc778 lsof -p <nginx-pid>","title":"3. \uc131\ub2a5 \ubd84\uc11d"},{"location":"troubleshooting/#_15","text":"","title":"\ubb38\uc81c\ubcc4 \uccb4\ud06c\ub9ac\uc2a4\ud2b8"},{"location":"troubleshooting/#_16","text":"\ud3ec\ud2b8 \ucda9\ub3cc \ud655\uc778 NGINX \uc124\uc815 \ubb38\ubc95 \uac80\uc0ac \ud30c\uc77c \uad8c\ud55c \ud655\uc778 \ub85c\uadf8 \ud30c\uc77c \ud655\uc778 \ub9ac\uc18c\uc2a4 \uc81c\ud55c \ud655\uc778","title":"\uc11c\ube44\uc2a4 \uc2dc\uc791 \uc2e4\ud328"},{"location":"troubleshooting/#_17","text":"\uc11c\ube44\uc2a4 \uc0c1\ud0dc \ud655\uc778 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \ud14c\uc2a4\ud2b8 \ubc29\ud654\ubcbd \uc124\uc815 \ud655\uc778 DNS \ud574\uc11d \ud655\uc778 \ud504\ub85d\uc2dc \uc124\uc815 \ud655\uc778","title":"\uc5f0\uacb0 \ubb38\uc81c"},{"location":"troubleshooting/#_18","text":"\ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub960 \ud655\uc778 NGINX \uc124\uc815 \ucd5c\uc801\ud654 \uce90\uc2dc \uc124\uc815 \ud655\uc778 \ub85c\ub4dc \ubc38\ub7f0\uc2f1 \ud655\uc778 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc5f0\uacb0 \ud655\uc778","title":"\uc131\ub2a5 \ubb38\uc81c"},{"location":"troubleshooting/#ssltls","text":"\uc778\uc99d\uc11c \uc720\ud6a8\uc131 \ud655\uc778 \uc778\uc99d\uc11c \ub9cc\ub8cc\uc77c \ud655\uc778 SSL \uc124\uc815 \uac80\ud1a0 \uc911\uac04 \uc778\uc99d\uc11c \ud655\uc778 \uc554\ud638\ud654 \uc2a4\uc704\ud2b8 \ud655\uc778","title":"SSL/TLS \ubb38\uc81c"},{"location":"troubleshooting/#_19","text":"","title":"\uc751\uae09 \ubcf5\uad6c \uc808\ucc28"},{"location":"troubleshooting/#1_2","text":"1 2 3 4 5 6 7 8 # Docker Compose \ub864\ubc31 docker-compose down git checkout HEAD~1 -- docker-compose.yml docker-compose up -d # Kubernetes \ub864\ubc31 kubectl rollout undo deployment/ ${ { values.name } } -n ${ { values.namespace } } kubectl rollout status deployment/ ${ { values.name } } -n ${ { values.namespace } }","title":"1. \uc11c\ube44\uc2a4 \ub864\ubc31"},{"location":"troubleshooting/#2_2","text":"1 2 3 4 5 6 7 # \ubc31\uc5c5\uc5d0\uc11c \uc124\uc815 \ubcf5\uad6c cp /backup/nginx.conf.backup config/nginx.conf docker-compose restart nginx # Git\uc5d0\uc11c \uc124\uc815 \ubcf5\uad6c git checkout HEAD -- config/ docker-compose restart nginx","title":"2. \uc124\uc815 \ubcf5\uad6c"},{"location":"troubleshooting/#3_1","text":"1 2 3 4 5 # \uc720\uc9c0\ubcf4\uc218 \ud398\uc774\uc9c0 \ud65c\uc131\ud654 cp maintenance.html html/index.html # \ub85c\ub4dc \ubc38\ub7f0\uc11c\uc5d0\uc11c \uc11c\ubc84 \uc81c\uc678 # (\ub85c\ub4dc \ubc38\ub7f0\uc11c\ubcc4 \uc124\uc815 \ubc29\ubc95 \ucc38\uc870)","title":"3. \ud2b8\ub798\ud53d \uc6b0\ud68c"},{"location":"troubleshooting/#_20","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/bin/bash # collect-logs.sh TIMESTAMP = $( date +%Y%m%d_%H%M%S ) LOG_DIR = \"/tmp/nginx-logs- $TIMESTAMP \" mkdir -p $LOG_DIR echo \"Collecting NGINX logs and diagnostics...\" # \uae30\ubcf8 \uc815\ubcf4 echo \"=== System Information ===\" > $LOG_DIR /system-info.txt uname -a >> $LOG_DIR /system-info.txt date >> $LOG_DIR /system-info.txt # NGINX \uc124\uc815 echo \"=== NGINX Configuration ===\" > $LOG_DIR /nginx-config.txt nginx -T >> $LOG_DIR /nginx-config.txt 2 > & 1 # \ub85c\uadf8 \ud30c\uc77c cp /var/log/nginx/*.log $LOG_DIR / 2 >/dev/null # \ud504\ub85c\uc138\uc2a4 \uc815\ubcf4 echo \"=== Process Information ===\" > $LOG_DIR /process-info.txt ps aux | grep nginx >> $LOG_DIR /process-info.txt # \ub124\ud2b8\uc6cc\ud06c \uc815\ubcf4 echo \"=== Network Information ===\" > $LOG_DIR /network-info.txt netstat -tulpn | grep nginx >> $LOG_DIR /network-info.txt # Docker/Kubernetes \uc815\ubcf4 if command -v docker & > /dev/null ; then echo \"=== Docker Information ===\" > $LOG_DIR /docker-info.txt docker ps | grep nginx >> $LOG_DIR /docker-info.txt docker logs nginx >> $LOG_DIR /docker-logs.txt 2 > & 1 fi if command -v kubectl & > /dev/null ; then echo \"=== Kubernetes Information ===\" > $LOG_DIR /k8s-info.txt kubectl get pods -n ${ { values.namespace } } >> $LOG_DIR /k8s-info.txt kubectl describe deployment/ ${ { values.name } } -n ${ { values.namespace } } >> $LOG_DIR /k8s-describe.txt kubectl logs deployment/ ${ { values.name } } -n ${ { values.namespace } } >> $LOG_DIR /k8s-logs.txt fi # \uc555\ucd95 tar -czf nginx-diagnostics- $TIMESTAMP .tar.gz -C /tmp nginx-logs- $TIMESTAMP / echo \"Diagnostics collected: nginx-diagnostics- $TIMESTAMP .tar.gz\"","title":"\ub85c\uadf8 \uc218\uc9d1 \uc2a4\ud06c\ub9bd\ud2b8"},{"location":"troubleshooting/#_21","text":"\ubb38\uc81c\uac00 \ud574\uacb0\ub418\uc9c0 \uc54a\uc73c\uba74 \ub2e4\uc74c \ucc44\ub110\uc744 \ud1b5\ud574 \uc9c0\uc6d0\uc744 \uc694\uccad\ud558\uc138\uc694: GitHub Issues : test-org/nginx-test-service/issues Platform Team : platform-team@company.com \uae34\uae09 \uc0c1\ud669 : +82-10-XXXX-XXXX (24/7 \uc9c0\uc6d0)","title":"\uc9c0\uc6d0 \uc5f0\ub77d\ucc98"},{"location":"troubleshooting/#_22","text":"\ubb38\uc81c \ubc1c\uc0dd \uc2dc\uac04 \uc624\ub958 \uba54\uc2dc\uc9c0 (\uc804\uccb4 \uc2a4\ud0dd \ud2b8\ub808\uc774\uc2a4) \ub85c\uadf8 \ud30c\uc77c (\uc704 \uc2a4\ud06c\ub9bd\ud2b8\ub85c \uc218\uc9d1) \ud658\uacbd \uc815\ubcf4 (OS, Docker/Kubernetes \ubc84\uc804) \ucd5c\uadfc \ubcc0\uacbd\uc0ac\ud56d \uc7ac\ud604 \ub2e8\uacc4","title":"\uc9c0\uc6d0 \uc694\uccad \uc2dc \ud3ec\ud568\ud560 \uc815\ubcf4"}]}