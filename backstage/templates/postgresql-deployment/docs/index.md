# PostgreSQL 데이터베이스 클러스터 배포 템플릿

고가용성, 백업, 모니터링 기능을 포함한 프로덕션 준비된 PostgreSQL 데이터베이스 클러스터 배포 템플릿입니다.

## 🚀 개요

이 템플릿은 엔터프라이즈급 PostgreSQL 데이터베이스 클러스터를 빠르게 배포할 수 있도록 설계되었습니다. 고가용성, 자동 백업, 실시간 모니터링, 보안 기능을 모두 포함하여 프로덕션 환경에서 바로 사용할 수 있습니다.

## ✨ 주요 기능

### 🏗️ 고가용성 아키텍처
- **마스터/슬레이브 복제** - 읽기 성능 향상 및 장애 복구
- **동기/비동기 복제** - 데이터 일관성과 성능 간 균형
- **자동 장애 조치** - 마스터 장애 시 자동 복구
- **연결 풀링** - PgBouncer를 통한 효율적인 연결 관리

### 💾 백업 및 복구
- **자동 백업** - Cron 기반 정기 백업
- **다중 저장소 지원** - 로컬, S3, GCS, Azure 지원
- **WAL 아카이빙** - Point-in-Time Recovery (PITR) 지원
- **백업 검증** - 자동 무결성 검사

### 📊 모니터링 및 관찰성
- **Prometheus 메트릭** - 상세한 성능 지표 수집
- **Grafana 대시보드** - 시각적 모니터링
- **pgAdmin 웹 인터페이스** - 데이터베이스 관리
- **알림 시스템** - 장애 및 성능 이슈 알림

### 🔒 보안 기능
- **SSL/TLS 암호화** - 전송 중 데이터 보호
- **네트워크 정책** - Kubernetes 네트워크 보안
- **역할 기반 접근 제어** - 세밀한 권한 관리
- **비밀번호 복잡성** - 강력한 인증 정책

## 🏗️ 아키텍처

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Application   │───►│   PgBouncer     │───►│  PostgreSQL     │
│   (Client)      │    │ (Connection     │    │   Master        │
└─────────────────┘    │  Pooling)       │    └─────────────────┘
                       └─────────────────┘             │
                                                       ▼ (Replication)
                       ┌─────────────────┐    ┌─────────────────┐
                       │   Monitoring    │    │  PostgreSQL     │
                       │ (Prometheus +   │◄───┤   Replica 1     │
                       │  Grafana)       │    └─────────────────┘
                       └─────────────────┘             │
                                                       ▼ (Replication)
                       ┌─────────────────┐    ┌─────────────────┐
                       │     Backup      │    │  PostgreSQL     │
                       │   (Automated    │    │   Replica 2     │
                       │   + WAL)        │    └─────────────────┘
                       └─────────────────┘
                                │
                                ▼
                       ┌─────────────────┐
                       │  Cloud Storage  │
                       │ (S3/GCS/Azure)  │
                       └─────────────────┘
```

## 🎯 지원 배포 환경

### Docker Compose
- **개발/테스트 환경** - 로컬 개발 및 테스트
- **빠른 프로토타이핑** - 개념 검증 및 데모
- **단일 서버 배포** - 소규모 프로덕션 환경

### Kubernetes
- **프로덕션 환경** - 확장 가능한 클러스터 배포
- **고가용성** - 다중 노드 분산 배포
- **자동 스케일링** - 부하에 따른 자동 확장

### Helm Chart
- **고급 설정** - 복잡한 배포 시나리오
- **템플릿화** - 환경별 맞춤 설정
- **버전 관리** - 배포 버전 추적

## 📋 지원 PostgreSQL 버전

- **PostgreSQL 15** - 최신 안정 버전 (권장)
- **PostgreSQL 14** - 이전 안정 버전
- **PostgreSQL 13** - LTS 지원
- **PostgreSQL 12** - 레거시 지원

## 🔧 설정 옵션

### 기본 설정
- **데이터베이스 이름** - 애플리케이션 데이터베이스
- **사용자 계정** - 애플리케이션 사용자
- **연결 제한** - 최대 동시 연결 수
- **SSL 설정** - 암호화 연결 활성화

### 고가용성 설정
- **복제본 수** - 읽기 전용 복제본 개수 (1-5개)
- **복제 모드** - 동기/비동기 복제 선택
- **연결 풀링** - PgBouncer 활성화
- **장애 조치** - 자동 복구 설정

### 백업 설정
- **백업 스케줄** - Cron 형식 스케줄
- **보존 기간** - 백업 파일 보관 일수
- **저장소 타입** - 로컬/클라우드 저장소
- **WAL 아카이빙** - PITR 지원

### 리소스 설정
- **CPU/메모리** - 노드별 리소스 할당
- **스토리지** - 데이터 볼륨 크기
- **스토리지 클래스** - 성능 등급 선택

## 🚀 빠른 시작

### 1. 템플릿 선택
Backstage에서 "PostgreSQL Deployment" 템플릿을 선택합니다.

### 2. 기본 정보 입력
- 클러스터 이름: `my-postgres-cluster`
- 설명: `Production PostgreSQL cluster`
- 소유자: 팀 또는 개인 선택

### 3. PostgreSQL 설정
- 버전: PostgreSQL 15 (권장)
- 데이터베이스: `myapp`
- 사용자: `appuser`
- SSL: 활성화 (권장)

### 4. 고가용성 설정
- 복제 활성화: ✅
- 복제본 수: 2개
- PgBouncer: ✅
- 최대 연결: 200

### 5. 백업 설정
- 자동 백업: ✅
- 스케줄: `0 2 * * *` (매일 오전 2시)
- 보존 기간: 30일
- 저장소: S3/GCS/Azure 선택

### 6. 모니터링 설정
- Prometheus 메트릭: ✅
- pgAdmin 인터페이스: ✅
- 상세 로깅: ✅

### 7. 배포 환경 선택
- **Docker Compose**: 개발/테스트
- **Kubernetes**: 프로덕션 (권장)
- **Helm Chart**: 고급 설정

## 📊 모니터링 대시보드

### 주요 메트릭
- **연결 수** - 활성/유휴 연결 모니터링
- **쿼리 성능** - 실행 시간 및 처리량
- **복제 지연** - 마스터-슬레이브 동기화 상태
- **디스크 사용량** - 스토리지 용량 모니터링
- **백업 상태** - 백업 성공/실패 추적

### Grafana 대시보드
사전 구성된 대시보드를 통해 다음을 모니터링할 수 있습니다:
- PostgreSQL 개요
- 쿼리 성능 분석
- 복제 상태
- 시스템 리소스
- 백업 및 복구 상태

## 🔒 보안 모범 사례

### 네트워크 보안
- **네트워크 정책** - 트래픽 제한 및 격리
- **SSL/TLS** - 전송 암호화
- **방화벽 규칙** - 포트 및 IP 제한

### 인증 및 권한
- **강력한 비밀번호** - 복잡성 요구사항
- **역할 기반 접근** - 최소 권한 원칙
- **정기 감사** - 접근 로그 모니터링

### 데이터 보호
- **암호화** - 저장 및 전송 중 암호화
- **백업 보안** - 백업 파일 암호화
- **접근 제어** - 데이터베이스 수준 보안

## 📚 문서 구조

- **[Getting Started](getting-started.md)** - 설치 및 초기 설정
- **[Configuration](configuration.md)** - 상세 설정 옵션
- **[High Availability](high-availability.md)** - 고가용성 구성
- **[Backup & Recovery](backup-recovery.md)** - 백업 및 복구 가이드
- **[Monitoring](monitoring.md)** - 모니터링 설정
- **[Security](security.md)** - 보안 설정 가이드
- **[Troubleshooting](troubleshooting.md)** - 문제 해결
- **[Best Practices](best-practices.md)** - 운영 모범 사례

## 🤝 지원 및 기여

문제가 발생하거나 개선 사항이 있다면 언제든지 연락해 주세요:

- **이슈 리포트** - GitHub Issues
- **기능 요청** - Feature Request
- **문서 개선** - Pull Request
- **커뮤니티** - Slack 채널

---

**버전**: 1.0.0  
**최종 업데이트**: 2026년 2월  
**PostgreSQL 호환성**: 12, 13, 14, 15  
**Kubernetes 호환성**: 1.20+